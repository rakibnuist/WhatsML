import{c as u,o as d,F as k,h as O,C as T,d as c,z as Y,r as _,p as v,m as K,J as P,l as Q,a as J,k as M,b as C,u as i,f as U,t as b,v as A,n as q}from"./app-fEKA3BkQ.js";import{m as L}from"./vue3-apexcharts-DT7e7b_A.js";import{_ as H}from"./UserLayout-D_lxcpvH.js";import{_ as X}from"./NotificationRing-DGOcuzJf.js";import{c as Z}from"./PageHeader-DmRLoM5E.js";import{h as ee}from"./moment-BAtM24Ew.js";import{s as ae}from"./assetStore-BSVLrDIW.js";import"./ValidationErrors-B24rcOPH.js";import"./echoServiceComposable-DxEMrh9X.js";const se={class:"mb-4 grid grid-cols-1 gap-4 lg:grid-cols-4"},te={__name:"OverviewCard",props:{skeletonCount:{type:Number,default:4}},setup(y){return(g,p)=>(d(),u("section",se,[(d(!0),u(k,null,O(y.skeletonCount,a=>(d(),u("div",{key:a,class:"card animate-pulse"},p[0]||(p[0]=[T('<div class="card-body flex items-center gap-2"><div class="h-10 w-10 rounded-full bg-dark-600 bg-opacity-20 p-3 text-xl dark:bg-dark-300"></div><div class="flex flex-1 flex-col gap-2"><div class="h-3 w-28 rounded bg-dark-300"></div><div class="h-4 w-16 rounded bg-dark-400"></div></div></div>',1)])))),128))]))}},oe={},re={class:"card flex h-[28rem] animate-pulse flex-col justify-between bg-gray-300 p-5"};function le(y,g){return d(),u("div",re,g[0]||(g[0]=[c("div",{class:"h-6 w-1/3 rounded bg-dark-500"},null,-1),c("div",{class:"h-40 rounded bg-dark-500"},null,-1),c("div",{class:"mx-auto h-6 w-1/4 rounded bg-dark-500"},null,-1)]))}const G=Z(oe,[["render",le]]),{moduleLabel:$,pickBy:ne}=ae(),ie=Y("userDashboard",()=>{const y=_(null),g=_({campaigns:"month",customers:"month",messages:"month"}),p=_(["#3c355b","#2a8f9e","#8b8c99","#6b56a3","#c0392b","#138d29","#2b7ca9"]),a=_({customers:{data:[],loading:!1},campaigns:{data:[],loading:!1},messages:{data:[],loading:!1},overviews:{data:[],loading:!1},schedule_campaigns:{data:[],loading:!1},storage:{data:0,loading:!1},plan_data:{data:0,loading:!1}});function x(e=!0,t="all"){t==="all"?Object.keys(a.value).forEach(s=>{a.value[s].loading=e}):a.value[t].loading=e}async function B({type:e="all",filter:t=null,platform:s=null,user_id:o=null}){x(!0,e),y.value=null;try{const r=ne({analytics:e,filter:t,platform:s,user_id:o}),m=await K.get("/api/user/dashboard",{params:r}),{data:l}=m,z={all:()=>{a.value.customers.data=l.customers,a.value.campaigns.data=l.campaigns,a.value.messages.data=l.messages,a.value.overviews.data=l.overviews},customers:()=>{a.value[e].data=l.customers},campaigns:()=>{a.value[e].data=l.campaigns},messages:()=>{a.value[e].data=l.messages},overviews:()=>{a.value[e].data=l.overviews},schedule_campaigns:()=>{a.value[e].data=l.schedule_campaigns},storage:()=>{a.value[e].data=l.storage},plan_data:()=>{a.value[e].data=l.plan_data}}[e];return z&&z(),x(!1,e),l}catch(r){throw x(!1,e),y.value=`Failed to fetch ${e} analytics: ${r.message}`,r}}function f(e){const t=[...new Set(Object.values(e).flatMap(o=>o.map(r=>r.date)))].sort((o,r)=>new Date(o)-new Date(r));return{series:Object.entries(e).map(([o,r])=>{const m=new Map(r.map(l=>[l.date,l.total]));return{name:$(o),data:t.map(l=>m.get(l)||0)}}),dates:t}}function S(e){const t=e.match(/([\d.]+)\s*(GB|MB|KB|B)/i);if(!t)throw new Error("Invalid format. Use a format like '2.00 GB'.");const s=parseFloat(t[1]),o=t[2].toUpperCase(),r={B:1,KB:1024,MB:1024**2,GB:1024**3};return Math.round(s*r[o])}const w=v(()=>Object.keys(a.value).map(e=>({[e]:a.value[e].data}))),h=v(()=>Object.values(a.value).every(e=>e.loading)),F=v(()=>{const{series:e,dates:t}=f(a.value.customers.data);return{series:e,chartOptions:{colors:p.value,chart:{height:400,type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(s){return s.toFixed(0)}}}}}}),n=v(()=>{var r,m,l,D;const e=(r=a.value.storage)==null?void 0:r.data,t=((D=(l=(m=a.value.plan_data)==null?void 0:m.data)==null?void 0:l.storage)==null?void 0:D.value)||1,s=e?S(e):0,o=S(t+".00 GB");return Math.round(s/o*100)}),j=v(()=>{var s,o,r,m;const e=((r=(o=(s=a.value.plan_data)==null?void 0:s.data)==null?void 0:o.storage)==null?void 0:r.value)||"0.00 GB",t=`${(m=a.value.storage)==null?void 0:m.data} / ${e===-1?"Unlimited":e+" GB"}`;return{series:[n.value],chartOptions:{chart:{height:300,type:"radialBar",offsetY:30,toolbar:{show:!1}},plotOptions:{radialBar:{startAngle:-90,endAngle:90,hollow:{size:"60%"},track:{background:"#9ca3af",strokeWidth:"100%",margin:15},dataLabels:{name:{show:!0,offsetY:-20,fontSize:"13px",fontWeight:"500",color:"#9ca3af"},value:{offsetY:-10,fontSize:"14px",fontWeight:"bold",color:"#9ca3af",formatter:()=>t??"Loading..."}}}},colors:["#6E43D4"],fill:{type:"solid",colors:["#1daa61"]},stroke:{lineCap:"round"},labels:["Storage Usage"]}}}),W=v(()=>{var s;const{series:e,dates:t}=f((s=a.value.campaigns)==null?void 0:s.data);return{series:e,chartOptions:{colors:p.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),N=v(()=>{var s;const{series:e,dates:t}=f((s=a.value.messages)==null?void 0:s.data);return{series:e,chartOptions:{colors:p.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),V=v(()=>{var t;const e=Object.entries((t=a.value.messages)==null?void 0:t.data).map(([s,o])=>{const r=o.reduce((m,l)=>m+l.total,0);return{name:$(s),value:r}});return{series:e.map(s=>s.value),chartOptions:{chart:{type:"donut"},colors:p.value,height:160,labels:e.map(s=>s.name),responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]}}}),E=v(()=>{var s;const e=Object.entries((s=a.value.messages)==null?void 0:s.data).map(([o,r])=>({name:o,value:r.reduce((m,l)=>m+l.total,0)})),t=e.reduce((o,r)=>o+r.value,0);return e.map(o=>({name:$(o.name),value:t>0?Number((o.value/t*100).toFixed(2)):0}))}),I=v(()=>{const e=[],t=new Date;for(let s=0;s<7;s++)e.push(ee(t).add(s,"days").format("D"));return e}),R=_(["day","week","month","year"]);return{analytics:a,error:y,filterForm:g,dateFilterQueries:R,chartColors:p,loading:h,fetchAnalytics:B,growthChart:F,campaignChart:W,messageChart:N,pieChart:V,storageChart:j,calculatePlatformPercentages:E,currentWeekDays:I,analyticsData:w}}),ce={key:1,class:"mb-4 grid grid-cols-1 gap-4 xl:grid-cols-4"},de={class:"flex items-center gap-3 p-5"},ue={class:"flex flex-1 flex-col"},pe={class:"text-sm tracking-wide text-slate-500"},me={class:"grid grid-cols-1 gap-4 lg:grid-cols-2"},ge={key:1,class:"card card-body rounded-2xl"},fe={class:"flex flex-wrap justify-between gap-2"},he={value:"",selected:""},ve=["value","selected"],be={key:3,class:"card card-body rounded-2xl"},ye={class:"flex flex-wrap justify-between gap-2"},xe={value:"",selected:""},we=["value","selected"],Me=Object.assign({layout:H},{__name:"Index",props:[],setup(y){const g=ie(),{analytics:p,campaignChart:a,messageChart:x,dateFilterQueries:B,filterForm:f,loading:S}=P(g);return Q(()=>{g.fetchAnalytics({type:"overviews",filter:"year",platform:"whatsapp"}),g.fetchAnalytics({type:"messages",filter:"year",platform:"whatsapp"}),g.fetchAnalytics({type:"campaigns",filter:"year",platform:"whatsapp"})}),(w,h)=>{const F=J("Icon");return d(),u(k,null,[i(p).overviews.loading?(d(),M(te,{key:0,"skeleton-count":8})):(d(),u("section",ce,[(d(!0),u(k,null,O(i(p).overviews.data,(n,j)=>(d(),u("div",{key:j,class:"card rounded-2xl"},[c("div",de,[c("div",{class:q(["flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-opacity-10",n.style])},[C(F,{icon:n.icon,class:"text-2xl"},null,8,["icon"])],2),c("div",ue,[c("p",pe,b(n.title),1),c("h5",null,b(n.value),1)])])]))),128))])),C(X),c("div",me,[i(p).messages.loading?(d(),M(G,{key:0})):(d(),u("div",ge,[c("div",fe,[c("h6",null,b(w.trans("Message Statistics")),1),U(c("select",{"onUpdate:modelValue":h[0]||(h[0]=n=>i(f).messages=n),onChange:h[1]||(h[1]=n=>i(g).fetchAnalytics({type:"messages",filter:i(f).messages,platform:"whatsapp"})),class:"select select-xl w-full capitalize md:w-40"},[c("option",he,b(w.trans("Filter By")),1),(d(!0),u(k,null,O(i(B),n=>(d(),u("option",{value:n,key:n,selected:i(f).messages===n},b(n),9,ve))),128))],544),[[A,i(f).messages]])]),C(i(L),{height:"350",options:i(x).chartOptions,series:i(x).series},null,8,["options","series"])])),i(p).campaigns.loading?(d(),M(G,{key:2})):(d(),u("div",be,[c("div",ye,[c("h6",null,b(w.trans("Campaign Statistic")),1),U(c("select",{"onUpdate:modelValue":h[2]||(h[2]=n=>i(f).campaigns=n),onChange:h[3]||(h[3]=n=>i(g).fetchAnalytics({type:"campaigns",filter:i(f).campaigns,platform:"whatsapp"})),class:"select select-xl w-full capitalize md:w-40"},[c("option",xe,b(w.trans("Filter By")),1),(d(!0),u(k,null,O(i(B),n=>(d(),u("option",{value:n,key:n,selected:i(f).sales===n},b(n),9,we))),128))],544),[[A,i(f).campaigns]])]),C(i(L),{height:"350",options:i(a).chartOptions,series:i(a).series},null,8,["options","series"])]))])],64)}}});export{Me as default};
