import{G as U,s as z,k as d,m as c,H as G,c as L,o as W,a as w}from"./app-CHoD4jNo.js";import{h as E}from"./moment-BAtM24Ew.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const{moduleLabel:p,pickBy:A}=z(),H=U("userDashboard",()=>{const u=d(null),m=d({campaigns:"month",customers:"month",messages:"month"}),i=d(["#3c355b","#2a8f9e","#8b8c99","#6b56a3","#c0392b","#138d29","#2b7ca9"]),s=d({customers:{data:[],loading:!1},campaigns:{data:[],loading:!1},messages:{data:[],loading:!1},overviews:{data:[],loading:!1},schedule_campaigns:{data:[],loading:!1},storage:{data:0,loading:!1},plan_data:{data:0,loading:!1}});function g(a=!0,t="all"){t==="all"?Object.keys(s.value).forEach(e=>{s.value[e].loading=a}):s.value[t].loading=a}async function x({type:a="all",filter:t=null,platform:e=null,user_id:o=null}){g(!0,a),u.value=null;try{const r=A({analytics:a,filter:t,platform:e,user_id:o}),l=await G.get("/api/user/dashboard",{params:r}),{data:n}=l,b={all:()=>{s.value.customers.data=n.customers,s.value.campaigns.data=n.campaigns,s.value.messages.data=n.messages,s.value.overviews.data=n.overviews},customers:()=>{s.value[a].data=n.customers},campaigns:()=>{s.value[a].data=n.campaigns},messages:()=>{s.value[a].data=n.messages},overviews:()=>{s.value[a].data=n.overviews},schedule_campaigns:()=>{s.value[a].data=n.schedule_campaigns},storage:()=>{s.value[a].data=n.storage},plan_data:()=>{s.value[a].data=n.plan_data}}[a];return b&&b(),g(!1,a),n}catch(r){throw g(!1,a),u.value=`Failed to fetch ${a} analytics: ${r.message}`,r}}function f(a){const t=[...new Set(Object.values(a).flatMap(o=>o.map(r=>r.date)))].sort((o,r)=>new Date(o)-new Date(r));return{series:Object.entries(a).map(([o,r])=>{const l=new Map(r.map(n=>[n.date,n.total]));return{name:p(o),data:t.map(n=>l.get(n)||0)}}),dates:t}}function v(a){const t=a.match(/([\d.]+)\s*(GB|MB|KB|B)/i);if(!t)throw new Error("Invalid format. Use a format like '2.00 GB'.");const e=parseFloat(t[1]),o=t[2].toUpperCase(),r={B:1,KB:1024,MB:1024**2,GB:1024**3};return Math.round(e*r[o])}const y=c(()=>Object.keys(s.value).map(a=>({[a]:s.value[a].data}))),B=c(()=>Object.values(s.value).every(a=>a.loading)),k=c(()=>{const{series:a,dates:t}=f(s.value.customers.data);return{series:a,chartOptions:{colors:i.value,chart:{height:400,type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(e){return e.toFixed(0)}}}}}}),_=c(()=>{var r,l,n,h;const a=(r=s.value.storage)==null?void 0:r.data,t=((h=(n=(l=s.value.plan_data)==null?void 0:l.data)==null?void 0:n.storage)==null?void 0:h.value)||1,e=a?v(a):0,o=v(t+".00 GB");return Math.round(e/o*100)}),O=c(()=>{var e,o,r,l;const a=((r=(o=(e=s.value.plan_data)==null?void 0:e.data)==null?void 0:o.storage)==null?void 0:r.value)||"0.00 GB",t=`${(l=s.value.storage)==null?void 0:l.data} / ${a===-1?"Unlimited":a+" GB"}`;return{series:[_.value],chartOptions:{chart:{height:300,type:"radialBar",offsetY:30,toolbar:{show:!1}},plotOptions:{radialBar:{startAngle:-90,endAngle:90,hollow:{size:"60%"},track:{background:"#9ca3af",strokeWidth:"100%",margin:15},dataLabels:{name:{show:!0,offsetY:-20,fontSize:"13px",fontWeight:"500",color:"#9ca3af"},value:{offsetY:-10,fontSize:"14px",fontWeight:"bold",color:"#9ca3af",formatter:()=>t??"Loading..."}}}},colors:["#6E43D4"],fill:{type:"solid",colors:["#1daa61"]},stroke:{lineCap:"round"},labels:["Storage Usage"]}}}),C=c(()=>{var e;const{series:a,dates:t}=f((e=s.value.campaigns)==null?void 0:e.data);return{series:a,chartOptions:{colors:i.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),S=c(()=>{var e;const{series:a,dates:t}=f((e=s.value.messages)==null?void 0:e.data);return{series:a,chartOptions:{colors:i.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:t},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),D=c(()=>{var t;const a=Object.entries((t=s.value.messages)==null?void 0:t.data).map(([e,o])=>{const r=o.reduce((l,n)=>l+n.total,0);return{name:p(e),value:r}});return{series:a.map(e=>e.value),chartOptions:{chart:{type:"donut"},colors:i.value,height:160,labels:a.map(e=>e.name),responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]}}}),F=c(()=>{var e;const a=Object.entries((e=s.value.messages)==null?void 0:e.data).map(([o,r])=>({name:o,value:r.reduce((l,n)=>l+n.total,0)})),t=a.reduce((o,r)=>o+r.value,0);return a.map(o=>({name:p(o.name),value:t>0?Number((o.value/t*100).toFixed(2)):0}))}),M=c(()=>{const a=[],t=new Date;for(let e=0;e<7;e++)a.push(E(t).add(e,"days").format("D"));return a}),j=d(["day","week","month","year"]);return{analytics:s,error:u,filterForm:m,dateFilterQueries:j,chartColors:i,loading:B,fetchAnalytics:x,growthChart:k,campaignChart:C,messageChart:S,pieChart:D,storageChart:O,calculatePlatformPercentages:F,currentWeekDays:M,analyticsData:y}}),Y={},K={class:"card flex h-40 animate-pulse flex-col items-center justify-center bg-gray-300"};function N(u,m){return W(),L("div",K,m[0]||(m[0]=[w("div",{class:"h-6 w-1/2 rounded bg-gray-400"},null,-1),w("div",{class:"mt-2 h-4 w-1/3 rounded bg-gray-400"},null,-1)]))}const I=$(Y,[["render",N]]);export{I as C,H as u};
