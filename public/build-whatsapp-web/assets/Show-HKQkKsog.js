import{u as B}from"./modalStore-BgORG3Nn.js";import{k as C,l as L,p as O,T as z,r as H,c as f,o as i,a as u,b as s,i as h,f as w,t as n,F as I,g as V,w as M,j as q,u as g,n as x,s as G}from"./app-B4kV47qU.js";import{_ as P}from"./Modal-ChMy0A7y.js";import J from"./OverviewGrid-8XiXRoFO.js";import{_ as K}from"./NoDataFound-su6Kbmdk.js";import{_ as y}from"./SpinnerBtn-B3fjBeDL.js";import{_ as $}from"./InputField-DXo1g-Zb.js";import{s as X}from"./sharedComposable-VJJUONp6.js";import{t as b}from"./toastComposable-CvcyPmJb.js";import{_ as Z}from"./UserLayout-DG2qUs8x.js";import{s as ee}from"./multiselect-Bn1369QT.js";import{_ as se}from"./RangeSlider-Cql1TtbG.js";import{h as te}from"./moment-BAtM24Ew.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ToastrContainer-Cfx6wOd2.js";import"./AssetModal-vtiWQmiY.js";import"./IntersectionObserver-DbdokySM.js";import"./assetStore-cDK0Afhq.js";const ae={class:"mb-4 flex justify-end gap-2"},ne={class:"table-responsive mt-3 w-full"},le={class:"table"},oe={key:0,class:"tbody"},re={class:"space-y-4"},ie={class:"label mb-1"},ue={class:"text-xs text-primary-500"},de={for:"device_rotation_duration",class:"label mb-1"},ce={class:"styled-scrollbar max-h-[80vh] overflow-y-auto pb-3 pr-2"},me={class:"space-y-3"},pe={class:"mb-1 flex items-center justify-between"},ve={class:"flex gap-2"},fe=["onClick"],ge=["onClick"],be={class:"space-y-1"},he={class:"mt-4 flex justify-end gap-2"},Ne=Object.assign({layout:Z},{__name:"Show",props:["platforms","warmer"],setup(D){const m=D,F=B(),{badgeClass:S}=X(),a=C({selectedDevices:[],messageDelay:[1,100],isRunning:!1,isPaused:!1,currentFlowIndex:0}),l=C([]),d=C([{id:1,question:"Hi, how can I help you?",answer:"I need support",deviceId:null,type:"demo"},{id:2,question:"What type of service are you interested in?",answer:"Website Development",deviceId:null,type:"demo"},{id:3,question:"Would you like to schedule a consultation?",answer:"Yes, please",deviceId:null,type:"demo"}]),R=L(()=>[{title:"Total Messages",value:l.value.length,icon:"bx:message"},{title:"Messages Sent",value:l.value.filter(e=>e.status==="sent").length,icon:"bx:check-double"},{title:"Pending Messages",value:l.value.filter(e=>e.status==="pending").length,icon:"bx:time"}]);O(()=>{var e;F.open("automationConfig"),(e=m.warmer)!=null&&e.dataset&&m.warmer.dataset.length&&(d.value=m.warmer.dataset)});const Q=()=>{d.value.push({id:Date.now(),question:"",answer:"",deviceId:null,type:"custom"})},U=e=>{d.value.splice(e,1)},N=e=>{d.value.push({...e,id:Date.now(),type:"custom",question:`${e.question} (Copy)`})},T=()=>{if(d.value.length===0){b.danger("Please add at least one Q&A item");return}const e=a.value.selectedDevices;if(e.length<2){b.danger("Please select at least 2 platforms");return}l.value=[];let o=0,r=1;d.value.forEach(t=>{l.value.push({id:`${t.id}-q`,message:t.question,type:"question",deviceId:e[o],receiverId:e[r],originQA:t.id,status:"pending",timestamp:null}),o=(o+1)%e.length,r=(r+1)%e.length,l.value.push({id:`${t.id}-a`,message:t.answer,type:"answer",deviceId:e[o],receiverId:e[r],originQA:t.id,status:"pending",timestamp:null}),o=(o+1)%e.length,r=(r+1)%e.length})},j=()=>{if(a.value.selectedDevices.length<2){b.danger("Please select at least 2 platforms for conversation flow");return}if(p.hasErrors){b.danger("Please clear Q&A form errors");return}l.value.length>0&&(l.value=[]),T(),a.value.isRunning=!0,a.value.isPaused=!1,_()},E=()=>{a.value.isPaused=!0},W=()=>{a.value.isPaused=!1,_()},A=()=>{a.value.isRunning=!1,a.value.isPaused=!1,a.value.currentFlowIndex=0},_=()=>{if(!a.value.isRunning||a.value.isPaused)return;if(a.value.currentFlowIndex>=l.value.length){A(),b.success("Automation completed");return}const e=l.value[a.value.currentFlowIndex],o=e.deviceId,r=e.receiverId,t=Math.floor(Math.random()*a.value.messageDelay[1])+a.value.messageDelay[0];G.post(route("user.whatsapp-web.warmer.send-message"),{sender_id:o,device_id:r,message:e.message,delay:t}).then(()=>{l.value[a.value.currentFlowIndex].status="sent",l.value[a.value.currentFlowIndex].timestamp=new Date,a.value.currentFlowIndex++,_()}).catch(()=>{b.danger("Failed to send message")})},p=z({title:m.warmer.title,dataset:[]}),Y=()=>{p.dataset=d.value,p.put(route("user.whatsapp-web.warmer.update",{warmer:m.warmer.id}))};return(e,o)=>{const r=H("Icon");return i(),f(I,null,[u(J,{items:R.value,grid:3},null,8,["items"]),s("div",ae,[a.value.isRunning?w("",!0):(i(),h(y,{key:0,onClick:j,"btn-text":"Start Automation",classes:"btn btn-success",icon:"bx:play"})),a.value.isRunning&&!a.value.isPaused?(i(),h(y,{key:1,onClick:E,"btn-text":"Pause",classes:"btn btn-warning",icon:"fe:pause"})):w("",!0),a.value.isRunning&&a.value.isPaused?(i(),h(y,{key:2,onClick:W,"btn-text":"Resume",classes:"btn btn-info",icon:"fe:play"})):w("",!0),a.value.isRunning&&!a.value.isPaused?(i(),h(y,{key:3,processing:a.value.isRunning,onClick:A,"btn-text":"Stop",classes:"btn btn-danger",icon:"fe:stop"},null,8,["processing"])):w("",!0)]),s("div",ne,[s("table",le,[s("thead",null,[s("tr",null,[s("th",null,n(e.trans("Sender")),1),s("th",null,n(e.trans("Receiver")),1),s("th",null,n(e.trans("Message Type")),1),s("th",null,n(e.trans("Message")),1),s("th",null,n(e.trans("Status")),1),s("th",null,n(e.trans("Timestamp")),1)])]),l.value.length?(i(),f("tbody",oe,[(i(!0),f(I,null,V(l.value,t=>{var v,c;return i(),f("tr",{key:t.id,class:x({"bg-gray-50":t.type==="answer"})},[s("td",null,n((v=m.platforms.find(k=>k.id===t.deviceId))==null?void 0:v.name),1),s("td",null,n((c=m.platforms.find(k=>k.id===t.receiverId))==null?void 0:c.name),1),s("td",null,[s("span",null,n(t.type),1)]),s("td",null,n(t.message),1),s("td",null,[s("span",{class:x(g(S)(t.status))},n(t.status),3)]),s("td",null,n(t.timestamp?g(te)(t.timestamp).format("DD MMM, YYYY h:mm A"):e.trans("Waiting")),1)],2)}),128))])):(i(),h(K,{key:1,forTable:!0}))])]),u(P,{state:"automationConfig","header-title":"Configure Warmer Devices","header-state":!0},{default:M(()=>[s("div",re,[s("div",null,[s("label",ie,[q(n(e.trans("Select Devices for Conversation"))+" ",1),s("span",ue,"( "+n(e.trans("Only verified number"))+" )",1)]),u(g(ee),{mode:"tags",class:"multiselect-dark",modelValue:a.value.selectedDevices,"onUpdate:modelValue":o[0]||(o[0]=t=>a.value.selectedDevices=t),placeholder:"Select Devices for Conversation",valueProp:"id",label:"name",options:D.platforms},null,8,["modelValue","options"])]),s("div",null,[s("label",de,n(e.trans("Message Delay (in seconds)")),1),u(se,{class:"px-1",modelValue:a.value.messageDelay,"onUpdate:modelValue":o[1]||(o[1]=t=>a.value.messageDelay=t),step:2},null,8,["modelValue"])])])]),_:1}),u(P,{state:"qaConfig","header-title":"Configure Q&A Flow","header-state":!0},{default:M(()=>[s("div",ce,[s("div",me,[(i(!0),f(I,null,V(d.value,(t,v)=>(i(),f("div",{key:t.id,class:"relative rounded-lg border p-4 transition-shadow hover:shadow-md dark:border-slate-600"},[s("div",pe,[s("span",{class:x(["badge",t.type==="demo"?"badge-secondary":"badge-primary"])},n(t.type==="demo"?"Demo":"User"),3),s("div",ve,[s("button",{class:"btn btn-sm btn-info",onClick:c=>N(t)},[u(r,{icon:"bx:copy"})],8,fe),s("button",{class:"btn btn-sm btn-danger",onClick:c=>U(v)},[u(r,{icon:"bx:trash"})],8,ge)])]),s("div",be,[u($,{modelValue:t.question,"onUpdate:modelValue":c=>t.question=c,placeholder:"Enter question",label:"Question Message",error:g(p).errors[`dataset.${v}.question`]},null,8,["modelValue","onUpdate:modelValue","error"]),u($,{modelValue:t.answer,"onUpdate:modelValue":c=>t.answer=c,placeholder:"Enter answer",label:"Answer Message",error:g(p).errors[`dataset.${v}.answer`]},null,8,["modelValue","onUpdate:modelValue","error"])])]))),128))]),s("div",he,[s("button",{class:"btn btn-primary",onClick:Q},[u(r,{icon:"bx:plus"}),s("span",null,n(e.trans("Add New Q&A")),1)]),u(y,{processing:g(p).processing,class:"btn btn-success",onClick:Y,type:"button","btn-text":e.trans("Save"),icon:"bx:save"},null,8,["processing","btn-text"])])])]),_:1})],64)}}});export{Ne as default};
