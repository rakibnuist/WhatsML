import{u as E}from"./chatStore-CTtmOQOw.js";import N from"./PollPreview-DtWnWRrq.js";import B from"./LocationPreview-CZAH32iX.js";import{k as C,p as F,l as R,r as S,c as e,o as s,b as c,f as g,t as n,F as I,a as y,n as $,u as q}from"./app-B4kV47qU.js";import"./toastComposable-CvcyPmJb.js";import"./echoServiceComposable-n1MnmRL6.js";import"./modalStore-BgORG3Nn.js";const D=["title"],L={key:0,class:"absolute -bottom-3 right-2 rounded-full bg-white/50 p-1 text-sm"},U={key:1,class:"rounded bg-slate-200 p-2 italic dark:bg-gray-800"},z={key:2},A={key:3,class:"italic text-gray-400"},K={key:4},P={key:0},G={key:0,class:"pb-2 text-black dark:text-white"},H=["href"],J=["src"],Q={key:2,class:"italic"},W={key:5},X={key:0,class:"pb-2"},Y=["src"],Z={key:2},ee={key:6},se={key:0,class:"pb-2"},te=["src"],ae={key:2},oe={key:7},ie={key:0,class:"pb-2"},ne=["href"],le={key:8},de={key:9},ce={key:10},ge={key:11},re={class:"text-black dark:text-white"},Me={__name:"MessagePreview",props:{message:{type:Object,required:!0}},setup(o){const k=E(),r=o,d=C(null),u=C(!1);F(()=>{let i=Object.keys(r.message.message??[])[0];["imageMessage","videoMessage","audioMessage","documentMessage","stickerMessage"].includes(i)&&k.getMedia(r.message).then(t=>{d.value=t}).finally(()=>{u.value=!0}),setTimeout(()=>{u.value=!0},1e3*30)});const l=i=>{let a=null,t=r.message.message??{};return Object.keys(t).includes("conversation")||Object.keys(t).includes("extendedTextMessage")?a="text":Object.keys(t).includes("imageMessage")?a="image":Object.keys(t).includes("audioMessage")?a="audio":Object.keys(t).includes("videoMessage")?a="video":Object.keys(t).includes("documentMessage")?a="document":Object.keys(t).includes("stickerMessage")?a="sticker":Object.keys(t).includes("pollCreationMessage")?a="poll":Object.keys(t).includes("locationMessage")?a="location":Object.keys(t).includes("reactionMessage")?a="reaction":Object.keys(t).includes("editedMessage")?a="edited":Object.keys(t).includes("protocolMessage")&&t.protocolMessage.type=="REVOKE"&&(a="deleted"),a===i},p=R(()=>{var i,a,t,m;return(m=(t=(a=(i=r.message.message)==null?void 0:i.extendedTextMessage)==null?void 0:a.contextInfo)==null?void 0:t.quotedMessage)==null?void 0:m.conversation}),V=i=>{var t;return((t=r.message.key)!=null&&t.fromMe?"out":"in")===i};return(i,a)=>{var m,v,b,h,M,f,x,_,O,j,T,w;const t=S("Icon");return s(),e(I,null,[c("div",{title:o.message.type,class:$(["text-danger relative rounded-primary rounded-tl-none bg-slate-100 p-2 text-sm group-[.pr]:rounded-tl-primary group-[.pr]:rounded-tr-none group-[.pr]:text-white dark:bg-slate-700 dark:text-slate-300",{"group-[.pr]:bg-primary-500":l("text")||l("edited")}])},[c("div",null,[(v=(m=o.message.reactions)==null?void 0:m[0])!=null&&v.text?(s(),e("span",L,n(o.message.reactions[0].text),1)):g("",!0),p.value?(s(),e("div",U,n(p.value),1)):g("",!0),l("text")?(s(),e("p",z,n(o.message.message.conversation??((b=o.message.message.extendedTextMessage)==null?void 0:b.text)),1)):l("deleted")?(s(),e("p",A,n(i.trans("This message was deleted")),1)):l("image")||l("sticker")?(s(),e("div",K,[u.value?(s(),e(I,{key:1},[(h=o.message.message.imageMessage)!=null&&h.caption?(s(),e("p",G,n((M=o.message.message.imageMessage)==null?void 0:M.caption),1)):g("",!0),d.value?(s(),e("a",{key:1,href:d.value},[c("img",{src:d.value,class:"max-h-60 rounded"},null,8,J)],8,H)):(s(),e("p",Q,n(i.trans("Failed to load media")),1))],64)):(s(),e("p",P,n(i.trans("Loading media...")),1))])):l("audio")?(s(),e("div",W,[(f=o.message.message.audioMessage)!=null&&f.caption?(s(),e("p",X,n((x=o.message.message.audioMessage)==null?void 0:x.caption),1)):g("",!0),d.value?(s(),e("audio",{key:1,src:d.value,controls:""},null,8,Y)):u.value?g("",!0):(s(),e("p",Z,n(i.trans("Audio not available")),1))])):l("video")?(s(),e("div",ee,[(_=o.message.message.videoMessage)!=null&&_.caption?(s(),e("p",se,n((O=o.message.message.videoMessage)==null?void 0:O.caption),1)):g("",!0),d.value?(s(),e("video",{key:1,src:d.value,controls:""},null,8,te)):(s(),e("p",ae,n(i.trans("Video not available")),1))])):l("document")?(s(),e("div",oe,[(j=o.message.message.documentMessage)!=null&&j.caption?(s(),e("p",ie,n((T=o.message.message.documentMessage)==null?void 0:T.caption),1)):g("",!0),c("a",{target:"_blank",href:d.value,class:"flex items-center gap-3 rounded border p-3"},[y(t,{icon:"bx:file"}),c("p",null,n((w=o.message.message.documentMessage)==null?void 0:w.fileName),1)],8,ne)])):l("poll")?(s(),e("div",le,[y(N,{meta:o.message.message.pollCreationMessage},null,8,["meta"])])):l("location")?(s(),e("div",de,[y(B,{meta:o.message.message.locationMessage},null,8,["meta"])])):l("edited")?(s(),e("div",ce,[c("p",null,n(o.message.message.editedMessage.message.protocolMessage.editedMessage.conversation),1),a[1]||(a[1]=c("small",null,"Edited",-1))])):(s(),e("div",ge,[c("p",re,n(i.trans("Unsupported message type")),1)]))])],10,D),!l("deleted")&&!V("out")?(s(),e("button",{key:0,onClick:a[0]||(a[0]=me=>q(k).setReplying(o.message)),class:"rounded-full bg-gray-200 p-1 text-xl text-black hover:bg-gray-500"},[y(t,{icon:"bx:reply"})])):g("",!0)],64)}}};export{Me as default};
