import{c as V,o as E,C as ct,D as ft,k as j,l as we,s as _e,E as mt,G as $,A as pt,H as ht,r as rt,b as F,t as Re,a as K,f as ae,u as P,i as We,I as vt,p as gt,F as bt,g as yt,e as Ze,J as wt,d as Ke,h as Rt,K as ze,w as kt,L as xt,n as Ct}from"./app-B4kV47qU.js";import{h as et}from"./moment-BAtM24Ew.js";import{_ as St}from"./SpinnerBtn-B3fjBeDL.js";import{_ as Tt}from"./IntersectionObserver-DbdokySM.js";import{t as Je}from"./toastComposable-CvcyPmJb.js";import{u as Mt}from"./assetStore-cDK0Afhq.js";import{u as Lt}from"./chatStore-CTtmOQOw.js";import{u as it}from"./modalStore-BgORG3Nn.js";import At from"./Header-Debu5j2t.js";import{_ as Dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{e as Ut}from"./echoServiceComposable-n1MnmRL6.js";import Bt from"./MediaPreview-DyjxtSXz.js";import It from"./QuickReplyPreview-B02GpzkT.js";import Ft from"./ReplyPreview-C6uvOHOI.js";import _t from"./MessagePreview-BkhhnYFk.js";import"./PollPreview-DtWnWRrq.js";import"./LocationPreview-CZAH32iX.js";const Ot={},Et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:{margin:"auto",display:"block"},width:"35px",height:"35px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"};function Pt(Se,k){return E(),V("svg",Et,k[0]||(k[0]=[ct('<circle cx="84" cy="50" r="10" fill="#e15b64"><animate attributeName="r" repeatCount="indefinite" dur="0.25s" calcMode="spline" keyTimes="0;1" values="10;0" keySplines="0 0.5 0.5 1" begin="0s"></animate><animate attributeName="fill" repeatCount="indefinite" dur="1s" calcMode="discrete" keyTimes="0;0.25;0.5;0.75;1" values="#e15b64;#abbd81;#f8b26a;#f47e60;#e15b64" begin="0s"></animate></circle><circle cx="16" cy="50" r="10" fill="#e15b64"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate></circle><circle cx="50" cy="50" r="10" fill="#f47e60"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s"></animate></circle><circle cx="84" cy="50" r="10" fill="#f8b26a"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate></circle><circle cx="16" cy="50" r="10" fill="#abbd81"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s"></animate></circle>',5)]))}const jt=Dt(Ot,[["render",Pt]]),Nt=ft("chatStore",()=>{const Se=it(),k={voice_message:!0},L=j(null),ue=j({isOpen:!0}),H=j([]),X=we(()=>R.value.customer_name.length>0||R.value.badge_id?H.value:U.value),U=j([]),ve=j([]),Z=j([]),le=j([]),G=j([]),Y=j(null),se=j({isOpen:!1}),D=j(!1),C=j(),N=j(""),ee=j(null),ce=j([]),Ue=async()=>{var f,w;if(N.value.length===0){ce.value=[];return}try{te.value.message_searching=!0;const A=await _e.get(route("user.conversations.api","messages"),{params:{module:(f=L.value)==null?void 0:f.module,conversation_id:Y.value,search:N.value}});ce.value=((w=A.data)==null?void 0:w.data)??[]}catch(A){console.error(A)}finally{te.value.message_searching=!1}},de=j({message_id:null,message:""}),R=j({badge_id:null,customer_name:""}),te=j({sendingMessage:!1,messages:!1,conversations:!1,searching:!1,message_searching:!1}),ge=j({type:"text",message:"",caption:"",attachments:[],template:[]}),be=we(()=>U.value.length>0),fe=we(()=>Y.value!==null),z=we(()=>U.value.find(f=>f.id===Y.value)??{}),ke=we(()=>{const f=z.value.messages??[];return f.length?f.slice().reverse():[]}),Te=we(()=>{var f;return((f=de.value.message_id)==null?void 0:f.length)??!1}),xe=we(()=>{var f,w;return(((f=z.value)==null?void 0:f.module)??"").charAt(0).toUpperCase()+(((w=z.value)==null?void 0:w.module)??"").slice(1)}),De=f=>G.value.find(w=>w.id===f)??null,re=we(()=>{var A;let f=((A=z.value)==null?void 0:A.module)??"",w=Z.value;return y.value.length>0&&(w=w.filter(W=>W.message_template.toLowerCase().includes(y.value.toLowerCase()))),w.filter(W=>W.module===f).map(W=>W.message_template)}),Ie=we(()=>{var A,W;let f=((A=z.value)==null?void 0:A.module)??"",w=[];return((W=ge.value.message)==null?void 0:W.length)>0&&(w=Z.value.filter(O=>{var q;return O.message_template.toLowerCase().includes((q=ge.value.message)==null?void 0:q.toLowerCase())})),w.filter(O=>O.module===f).map(O=>O.message_template)}),Oe=we(()=>ve.value.filter(f=>f.module==z.value.module)),Ee=f=>{Y.value=f,z.value.unread_count=0},qe=()=>{se.value.isOpen=!se.value.isOpen},Me=(f="smooth")=>{setTimeout(()=>{let w=document.querySelector("#scrollContainerRef");w&&w.scrollIntoView({block:"end",behavior:f})},300)},r=f=>{var w;de.value={message_id:f.uuid,message:((w=f.body)==null?void 0:w.body)??f.type??"Unknown type"}},e=()=>{de.value={message_id:null,message:""}},t=f=>{f.updated_at=new Date().toISOString()},o=()=>{U.value.sort((f,w)=>new Date(w.updated_at)-new Date(f.updated_at))},s=f=>{var w;console.log("loading more messages"),!te.value.messages&&(te.value.messages=!0,_e.get(route("user.conversations.api","load_more_messages"),{params:{module:(w=L.value)==null?void 0:w.module,conversation_id:f??Y.value,limit:10,last_message_id:f?0:ke.value[0].id}}).then(function(A){let W=!1;if(A.data.length===0){if(W=!0,W){let O=U.value.find(q=>q.id==Y.value);O&&(O.no_more_messages=!0)}return}U.value=U.value.map(O=>(O.id==Y.value&&A.data.forEach((q,me)=>{O.messages.push(q)}),O))}).catch(A=>console.error(A)).finally(()=>{te.value.messages=!1}))},d=()=>{var f;console.log("load more conversations"),!te.value.conversations&&(te.value.conversations=!0,_e.get(route("user.conversations.api","load_more_conversations"),{params:{module:(f=L.value)==null?void 0:f.module,limit:10,last_conversation_id:U.value.length>0?U.value[0].id:null}}).then(function(w){if(w.data.length===0){console.log("no more conversations");return}let A=[];w.data.forEach(W=>{A.find(O=>O.id==W.id)||A.push(W)})}).catch(w=>console.error(w)).finally(()=>te.value.conversations=!1))},c=async()=>{try{const f=await _e.get(route("user.conversations.api","badges"));G.value=f.data}catch(f){console.error(f)}},i=async()=>{var w,A,W;let f={...ge.value,conversation_id:Y.value};de.value.message_id&&(f.context={id:de.value.message_id,title:de.value.message});try{te.value.sendingMessage=!0;const O=await _e.post(route("user.messages.store"),f,{headers:{"Content-Type":"multipart/form-data"}});U.value=U.value.map(q=>(q.id==Y.value&&q.messages.unshift(O.data),q)),ge.value={type:"text",message:"",caption:"",attachments:[],template:[]},Se.close(`${xe.value.toLowerCase()}TemplateModal`),(w=C.value)==null||w.focus(),e(),t(z.value),o()}catch(O){Je.danger(((W=(A=O.response)==null?void 0:A.data)==null?void 0:W.message)||O.message||"Something went wrong!"),console.error(O)}finally{te.value.sendingMessage=!1,D.value=!1,Me()}},l=j(0),y=j(""),m=j(!1),b=j(!1),h=j(),v=f=>{(b.value&&l.value<re.value.length-1||l.value<re.value.length-1)&&(l.value=l.value+1)},p=f=>{l.value>0&&(l.value=l.value-1)},T=async f=>{const w=document.getElementById("inputMessageField");w.blur(),g(),ge.value.message=B(f)+" ",await mt(),w.focus()},B=f=>{var A,W,O,q;let w={name:(A=z.value.customer)==null?void 0:A.name,phone:(W=z.value.customer)==null?void 0:W.uuid,username:(q=(O=z.value.customer)==null?void 0:O.meta)==null?void 0:q.username};return(f==null?void 0:f.replace(/\{([a-z_]+)\}/g,(me,ne)=>w.hasOwnProperty(ne)?w[ne]:me))??f},n=()=>{Se.open("quickReplyModal"),b.value=!0},g=()=>{Se.close("quickReplyModal"),b.value=!1},M=f=>{let w="";b.value,w=re.value[l.value],T(w),l.value=-1},a=f=>{var w;(w=Ut.connect())==null||w.private(f).subscribed(()=>console.log("Live chat activated successfully")).listen("IncomingNewMessageEvent",x).listen("IncomingMessageUpdateEvent",S).listen("IncomingNewConversationEvent",_).error(A=>console.error(A))},u=()=>{},x=f=>{console.log("new message received"),U.value.forEach(w=>{if(w.id===(f==null?void 0:f.conversation_id)){if(w.messages.find(W=>W.id===f.id))return;console.log("pushing new message"),w.messages.unshift(f),t(w),o(),w.unread_count+=1,I()}}),Me()},S=f=>{console.log("message update"),U.value.forEach(w=>{w.id==f.conversation_id&&w.messages.forEach(A=>{A.id==f.id&&(A.status=f.status)})})},_=f=>{var w;console.log("new conversation received"),U.value.value=U.value.unshift(f),s(f.id),f.unread_count=((w=f.messages)==null?void 0:w.length)??1},I=()=>{new Audio("/assets/incoming-message-beep.mp3").play()};return{features:k,platform:L,leftSidebar:ue,searchedConversationList:H,conversations:U,chatTemplates:ve,quickReplies:Z,aiTemplates:le,badges:G,activeConversationId:Y,rightSidebar:se,replying:de,searchForm:R,loading:te,assetPopup:D,messageInputFieldRef:C,chatSearchInput:N,chatSearchInputRef:ee,chatSearchedItems:ce,getChatSearchedItems:Ue,inputMessage:ge,quickReplySearchInput:y,quickReplySuggestionItemsShow:m,arrowCounter:l,hasConversations:be,hasActiveConversation:fe,activeConversation:z,activeConversationMessages:ke,isReplying:Te,getActiveModuleName:xe,getBadge:De,quickReplyFilteredItems:re,quickReplySuggestionItems:Ie,getActiveModuleTemplates:Oe,filteredConversations:X,setActiveConversation:Ee,toggleRightSidebar:qe,scrollToLastMessage:Me,setReplying:r,unsetReplying:e,loadMoreMessages:s,loadMoreConversations:d,addQuickReplyToMessageInput:T,loadBadges:c,submitMessage:i,touchConversation:t,shortConversations:o,quickReplyModalOpen:n,quickReplyModalClose:g,selectQuickReply:M,onArrowDown:v,onArrowUp:p,replaceTextWithShortCodes:B,quickReplyModalSearchInput:h,connectWebSocket:a,disconnectWebSocket:u,toggleLeftSidebar:()=>{ue.value.isOpen=!ue.value.isOpen}}});var Ye={exports:{}},tt;function zt(){return tt||(tt=1,function(Se){/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */function k(r,e){if(!r)throw"First parameter is required.";e=e||{type:"video"},e=new L(r,e);var t=this;function o(n){return e.disableLogs||console.log("RecordRTC version: ",t.version),n&&(e=new L(r,n)),e.disableLogs||console.log("started recording "+e.type+" stream."),p?(p.clearRecordedData(),p.record(),b("recording"),t.recordingDuration&&m(),t):(s(function(){t.recordingDuration&&m()}),t)}function s(n){n&&(e.initCallback=function(){n(),n=e.initCallback=null});var g=new ue(r,e);p=new g(r,e),p.record(),b("recording"),e.disableLogs||console.log("Initialized recorderType:",p.constructor.name,"for output-type:",e.type)}function d(n){if(n=n||function(){},!p){v();return}if(t.state==="paused"){t.resumeRecording(),setTimeout(function(){d(n)},1);return}t.state!=="recording"&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',t.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),e.type!=="gif"?p.stop(g):(p.stop(),g()),b("stopped");function g(M){if(!p){typeof n.call=="function"?n.call(t,""):n("");return}Object.keys(p).forEach(function(x){typeof p[x]!="function"&&(t[x]=p[x])});var a=p.blob;if(!a)if(M)p.blob=a=M;else throw"Recording failed.";if(a&&!e.disableLogs&&console.log(a.type,"->",ce(a.size)),n){var u;try{u=G.createObjectURL(a)}catch{}typeof n.call=="function"?n.call(t,u):n(u)}e.autoWriteToDisk&&y(function(x){var S={};S[e.type+"Blob"]=x,re.Store(S)})}}function c(){if(!p){v();return}if(t.state!=="recording"){e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",t.state);return}b("paused"),p.pause(),e.disableLogs||console.log("Paused recording.")}function i(){if(!p){v();return}if(t.state!=="paused"){e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",t.state);return}b("recording"),p.resume(),e.disableLogs||console.log("Resumed recording.")}function l(n){postMessage(new FileReaderSync().readAsDataURL(n))}function y(n,g){if(!n)throw"Pass a callback function over getDataURL.";var M=g?g.blob:(p||{}).blob;if(!M){e.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){y(n,g)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var a=x(l);a.onmessage=function(S){n(S.data)},a.postMessage(M)}else{var u=new FileReader;u.readAsDataURL(M),u.onload=function(S){n(S.target.result)}}function x(S){try{var _=G.createObjectURL(new Blob([S.toString(),"this.onmessage =  function (eee) {"+S.name+"(eee.data);}"],{type:"application/javascript"})),I=new Worker(_);return G.revokeObjectURL(_),I}catch{}}}function m(n){if(n=n||0,t.state==="paused"){setTimeout(function(){m(n)},1e3);return}if(t.state!=="stopped"){if(n>=t.recordingDuration){d(t.onRecordingStopped);return}n+=1e3,setTimeout(function(){m(n)},1e3)}}function b(n){t&&(t.state=n,typeof t.onStateChanged.call=="function"?t.onStateChanged.call(t,n):t.onStateChanged(n))}var h='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function v(){e.disableLogs!==!0&&console.warn(h)}var p,T={startRecording:o,stopRecording:d,pauseRecording:c,resumeRecording:i,initRecorder:s,setRecordingDuration:function(n,g){if(typeof n>"u")throw"recordingDuration is required.";if(typeof n!="number")throw"recordingDuration must be a number.";return t.recordingDuration=n,t.onRecordingStopped=g||function(){},{onRecordingStopped:function(M){t.onRecordingStopped=M}}},clearRecordedData:function(){if(!p){v();return}p.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!p){v();return}return p.blob},getDataURL:y,toURL:function(){if(!p){v();return}return G.createObjectURL(p.blob)},getInternalRecorder:function(){return p},save:function(n){if(!p){v();return}Ue(p.blob,n)},getFromDisk:function(n){if(!p){v();return}k.getFromDisk(e.type,n)},setAdvertisementArray:function(n){e.advertisement=[];for(var g=n.length,M=0;M<g;M++)e.advertisement.push({duration:M,image:n[M]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){t.state==="recording"&&!e.disableLogs&&console.warn("Stop an active recorder."),p&&typeof p.clearRecordedData=="function"&&p.clearRecordedData(),p=null,b("inactive"),t.blob=null},onStateChanged:function(n){e.disableLogs||console.log("Recorder state changed:",n)},state:"inactive",getState:function(){return t.state},destroy:function(){var n=e.disableLogs;e={disableLogs:!0},t.reset(),b("destroyed"),T=t=null,be.AudioContextConstructor&&(be.AudioContextConstructor.close(),be.AudioContextConstructor=null),e.disableLogs=n,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return t=T,T;for(var B in T)this[B]=T[B];return t=this,T}k.version="5.6.2",Se.exports=k,k.getFromDisk=function(r,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+(r==="all"?"blobs":r+" blob ")+" from disk!"),re.Fetch(function(t,o){r!=="all"&&o===r+"Blob"&&e&&e(t),r==="all"&&e&&e(t,o.replace("Blob",""))})},k.writeToDisk=function(r){console.log("Writing recorded blob(s) to disk!"),r=r||{},r.audio&&r.video&&r.gif?r.audio.getDataURL(function(e){r.video.getDataURL(function(t){r.gif.getDataURL(function(o){re.Store({audioBlob:e,videoBlob:t,gifBlob:o})})})}):r.audio&&r.video?r.audio.getDataURL(function(e){r.video.getDataURL(function(t){re.Store({audioBlob:e,videoBlob:t})})}):r.audio&&r.gif?r.audio.getDataURL(function(e){r.gif.getDataURL(function(t){re.Store({audioBlob:e,gifBlob:t})})}):r.video&&r.gif?r.video.getDataURL(function(e){r.gif.getDataURL(function(t){re.Store({videoBlob:e,gifBlob:t})})}):r.audio?r.audio.getDataURL(function(e){re.Store({audioBlob:e})}):r.video?r.video.getDataURL(function(e){re.Store({videoBlob:e})}):r.gif&&r.gif.getDataURL(function(e){re.Store({gifBlob:e})})};/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function L(r,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===xe||e.recorderType===Te||typeof Me<"u"&&e.recorderType===Me?e.type="video":e.recorderType===Ie?e.type="gif":e.recorderType===ke?e.type="audio":e.recorderType===z&&(R(r,"audio").length&&R(r,"video").length||!R(r,"audio").length&&R(r,"video").length?e.type="video":R(r,"audio").length&&!R(r,"video").length&&(e.type="audio"))),typeof z<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0]),e.bitsPerSecond),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function ue(r,e){var t;return(C||Y||se)&&(t=ke),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!C&&(t=z),e.type==="video"&&(C||se)&&(t=xe,typeof Me<"u"&&typeof ReadableStream<"u"&&(t=Me)),e.type==="gif"&&(t=Ie),e.type==="canvas"&&(t=Te),fe()&&t!==Te&&t!==Ie&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(R(r,"video").length||R(r,"audio").length)&&(e.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(t=z):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(t=z)),r instanceof Array&&r.length&&(t=Ee),e.recorderType&&(t=e.recorderType),!e.disableLogs&&t&&t.name&&console.log("Using recorderType:",t.name||t.constructor.name),!t&&N&&(t=z),t}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function H(r){this.addStream=function(e){e&&(r=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e=this.mediaType,t,o=this.mimeType||{audio:null,video:null,gif:null};if(typeof e.audio!="function"&&fe()&&!R(r,"audio").length&&(e.audio=!1),typeof e.video!="function"&&fe()&&!R(r,"video").length&&(e.video=!1),typeof e.gif!="function"&&fe()&&!R(r,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(t=null,typeof e.audio=="function"&&(t=e.audio),this.audioRecorder=new k(r,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:o.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){t=null,typeof e.video=="function"&&(t=e.video);var s=r;if(fe()&&e.audio&&typeof e.audio=="function"){var d=R(r,"video")[0];D?(s=new ee,s.addTrack(d),t&&t===xe&&(t=z)):(s=new ee,s.addTrack(d))}this.videoRecorder=new k(s,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:o.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var c=this,i=fe()===!0;(e.audio instanceof ke&&e.video||e.audio!==!0&&e.video!==!0&&e.audio!==e.video)&&(i=!1),i===!0?(c.audioRecorder=null,c.videoRecorder.startRecording()):c.videoRecorder.initRecorder(function(){c.audioRecorder.initRecorder(function(){c.videoRecorder.startRecording(),c.audioRecorder.startRecording()})})}e.gif&&(t=null,typeof e.gif=="function"&&(t=e.gif),this.gifRecorder=new k(r,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:o.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){this.getBlob(function(s){s.audio&&s.video?t(s.audio,function(d){t(s.video,function(c){e({audio:d,video:c})})}):s.audio?t(s.audio,function(d){e({audio:d})}):s.video&&t(s.video,function(d){e({video:d})})});function t(s,d){if(typeof Worker<"u"){var c=o(function(y){postMessage(new FileReaderSync().readAsDataURL(y))});c.onmessage=function(l){d(l.data)},c.postMessage(s)}else{var i=new FileReader;i.readAsDataURL(s),i.onload=function(l){d(l.target.result)}}}function o(s){var d=G.createObjectURL(new Blob([s.toString(),"this.onmessage =  function (eee) {"+s.name+"(eee.data);}"],{type:"application/javascript"})),c=new Worker(d),i;if(typeof G<"u")i=G;else if(typeof webkitURL<"u")i=webkitURL;else throw"Neither URL nor webkitURL detected.";return i.revokeObjectURL(d),c}},this.writeToDisk=function(){k.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save(typeof e.audio=="string"?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save(typeof e.video=="string"?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save(typeof e.gif=="string"?e.gif:"")}}H.getFromDisk=k.getFromDisk,H.writeToDisk=k.writeToDisk,typeof k<"u"&&(k.MRecordRTC=H);var X="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(r){r&&(typeof window<"u"||typeof $>"u"||($.navigator={userAgent:X,getUserMedia:function(){}},$.console||($.console={}),(typeof $.console.log>"u"||typeof $.console.error>"u")&&($.console.error=$.console.log=$.console.log||function(){console.log(arguments)}),typeof document>"u"&&(r.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},r.HTMLVideoElement=function(){}),typeof location>"u"&&(r.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(r.screen={width:0,height:0}),typeof G>"u"&&(r.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),r.window=$))})(typeof $<"u"?$:null);var U=window.requestAnimationFrame;if(typeof U>"u"){if(typeof webkitRequestAnimationFrame<"u")U=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")U=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")U=msRequestAnimationFrame;else if(typeof U>"u"){var ve=0;U=function(r,e){var t=new Date().getTime(),o=Math.max(0,16-(t-ve)),s=setTimeout(function(){r(t+o)},o);return ve=t+o,s}}}var Z=window.cancelAnimationFrame;typeof Z>"u"&&(typeof webkitCancelAnimationFrame<"u"?Z=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?Z=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?Z=msCancelAnimationFrame:typeof Z>"u"&&(Z=function(r){clearTimeout(r)}));var le=window.AudioContext;typeof le>"u"&&(typeof webkitAudioContext<"u"&&(le=webkitAudioContext),typeof mozAudioContext<"u"&&(le=mozAudioContext));var G=window.URL;typeof G>"u"&&typeof webkitURL<"u"&&(G=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var Y=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),se=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,D=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),C=!se&&!Y&&!!navigator.webkitGetUserMedia||de()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,N=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);N&&!C&&navigator.userAgent.indexOf("CriOS")!==-1&&(N=!1,C=!0);var ee=window.MediaStream;typeof ee>"u"&&typeof webkitMediaStream<"u"&&(ee=webkitMediaStream),typeof ee<"u"&&typeof ee.prototype.stop>"u"&&(ee.prototype.stop=function(){this.getTracks().forEach(function(r){r.stop()})});function ce(r){var e=1e3,t=["Bytes","KB","MB","GB","TB"];if(r===0)return"0 Bytes";var o=parseInt(Math.floor(Math.log(r)/Math.log(e)),10);return(r/Math.pow(e,o)).toPrecision(3)+" "+t[o]}function Ue(r,e){if(!r)throw"Blob object is required.";if(!r.type)try{r.type="video/webm"}catch{}var t=(r.type||"video/webm").split("/")[1];if(t.indexOf(";")!==-1&&(t=t.split(";")[0]),e&&e.indexOf(".")!==-1){var o=e.split(".");e=o[0],t=o[1]}var s=(e||Math.round(Math.random()*9999999999)+888888888)+"."+t;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(r,s);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(r,s);var d=document.createElement("a");d.href=G.createObjectURL(r),d.download=s,d.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(d),typeof d.click=="function"?d.click():(d.target="_blank",d.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),G.revokeObjectURL(d.href)}function de(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function R(r,e){return!r||!r.getTracks?[]:r.getTracks().filter(function(t){return t.kind===(e||"audio")})}function te(r,e){"srcObject"in e?e.srcObject=r:"mozSrcObject"in e?e.mozSrcObject=r:e.srcObject=r}function ge(r,e){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var t=new EBML.Reader,o=new EBML.Decoder,s=EBML.tools,d=new FileReader;d.onload=function(c){var i=o.decode(this.result);i.forEach(function(b){t.read(b)}),t.stop();var l=s.makeMetadataSeekable(t.metadatas,t.duration,t.cues),y=this.result.slice(t.metadataSize),m=new Blob([l,y],{type:"video/webm"});e(m)},d.readAsArrayBuffer(r)}typeof k<"u"&&(k.invokeSaveAsDialog=Ue,k.getTracks=R,k.getSeekableBlob=ge,k.bytesToSize=ce,k.isElectron=de);/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var be={};typeof le<"u"?be.AudioContext=le:typeof webkitAudioContext<"u"&&(be.AudioContext=webkitAudioContext),typeof k<"u"&&(k.Storage=be);function fe(){if(D||N||Y)return!0;var r=navigator.userAgent,e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10),o,s;return(C||se)&&(o=r.indexOf("Chrome"),e=r.substring(o+7)),(s=e.indexOf(";"))!==-1&&(e=e.substring(0,s)),(s=e.indexOf(" "))!==-1&&(e=e.substring(0,s)),t=parseInt(""+e,10),isNaN(t)&&(e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10)),t>=49}/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function z(r,e){var m=this;if(typeof r>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(e=e||{mimeType:"video/webm"},e.type==="audio"){if(R(r,"video").length&&R(r,"audio").length){var t;navigator.mozGetUserMedia?(t=new ee,t.addTrack(R(r,"audio")[0])):t=new ee(R(r,"audio")),r=t}(!e.mimeType||e.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(e.mimeType=C?"audio/webm":"audio/ogg"),e.mimeType&&e.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg")}var o=[];this.getArrayOfBlobs=function(){return o},this.record=function(){m.blob=null,m.clearRecordedData(),m.timestamps=[],y=[],o=[];var b=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",b),i&&(i=null),C&&!fe()&&(b="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&b.mimeType&&(MediaRecorder.isTypeSupported(b.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType),b.mimeType=e.type==="audio"?"audio/webm":"video/webm"));try{i=new MediaRecorder(r,b),e.mimeType=b.mimeType}catch{i=new MediaRecorder(r)}b.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&i.canRecordMimeType(b.mimeType)===!1&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",b.mimeType)),i.ondataavailable=function(h){if(h.data&&y.push("ondataavailable: "+ce(h.data.size)),typeof e.timeSlice=="number"){if(h.data&&h.data.size&&(o.push(h.data),s(),typeof e.ondataavailable=="function")){var v=e.getNativeBlob?h.data:new Blob([h.data],{type:d(b)});e.ondataavailable(v)}return}if(!h.data||!h.data.size||h.data.size<100||m.blob){m.recordingCallback&&(m.recordingCallback(new Blob([],{type:d(b)})),m.recordingCallback=null);return}m.blob=e.getNativeBlob?h.data:new Blob([h.data],{type:d(b)}),m.recordingCallback&&(m.recordingCallback(m.blob),m.recordingCallback=null)},i.onstart=function(){y.push("started")},i.onpause=function(){y.push("paused")},i.onresume=function(){y.push("resumed")},i.onstop=function(){y.push("stopped")},i.onerror=function(h){h&&(h.name||(h.name="UnknownError"),y.push("error: "+h),e.disableLogs||(h.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",h):h.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",b.mimeType,") is not supported.",h):h.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",h):h.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",h):h.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",h):h.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",h):h.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",h):console.error("MediaRecorder Error",h)),function(v){if(!m.manuallyStopped&&i&&i.state==="inactive"){delete e.timeslice,i.start(600*1e3);return}setTimeout(v,1e3)}(),i.state!=="inactive"&&i.state!=="stopped"&&i.stop())},typeof e.timeSlice=="number"?(s(),i.start(e.timeSlice)):i.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[];function s(){m.timestamps.push(new Date().getTime()),typeof e.onTimeStamp=="function"&&e.onTimeStamp(m.timestamps[m.timestamps.length-1],m.timestamps)}function d(b){return i&&i.mimeType?i.mimeType:b.mimeType||"video/webm"}this.stop=function(b){b=b||function(){},m.manuallyStopped=!0,i&&(this.recordingCallback=b,i.state==="recording"&&i.stop(),typeof e.timeSlice=="number"&&setTimeout(function(){m.blob=new Blob(o,{type:d(e)}),m.recordingCallback(m.blob)},100))},this.pause=function(){i&&i.state==="recording"&&i.pause()},this.resume=function(){i&&i.state==="paused"&&i.resume()},this.clearRecordedData=function(){i&&i.state==="recording"&&m.stop(c),c()};function c(){o=[],i=null,m.timestamps=[]}var i;this.getInternalRecorder=function(){return i};function l(){if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var y=[];this.getAllStates=function(){return y},typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!1);var m=this;(function b(){if(!(!i||e.checkForInactiveTracks===!1)){if(l()===!1){e.disableLogs||console.log("MediaStream seems stopped."),m.stop();return}setTimeout(b,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof k<"u"&&(k.MediaStreamRecorder=z);/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function ke(r,e){if(!R(r,"audio").length)throw"Your stream has no audio tracks.";e=e||{};var t=this,o=[],s=[],d=!1,c=0,i,l=2,y=e.desiredSampRate;e.leftChannel===!0&&(l=1),e.numberOfAudioChannels===1&&(l=1),(!l||l<1)&&(l=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+l),typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!0);function m(){if(e.checkForInactiveTracks===!1)return!0;if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}this.record=function(){if(m()===!1)throw"Please make sure MediaStream is active.";M(),u=g=!1,d=!0,typeof e.timeSlice<"u"&&_()};function b(I,J){function f(A,W){var O=A.numberOfAudioChannels,q=A.leftBuffers.slice(0),me=A.rightBuffers.slice(0),ne=A.sampleRate,Le=A.internalInterleavedLength,ye=A.desiredSampRate;O===2&&(q=Ve(q,Le),me=Ve(me,Le),ye&&(q=Fe(q,ye,ne),me=Fe(me,ye,ne))),O===1&&(q=Ve(q,Le),ye&&(q=Fe(q,ye,ne))),ye&&(ne=ye);function Fe(Q,Ce,pe){var he=Math.round(Q.length*(Ce/pe)),oe=[],Ae=Number((Q.length-1)/(he-1));oe[0]=Q[0];for(var Be=1;Be<he-1;Be++){var He=Be*Ae,Xe=Number(Math.floor(He)).toFixed(),ut=Number(Math.ceil(He)).toFixed(),lt=He-Xe;oe[Be]=at(Q[Xe],Q[ut],lt)}return oe[he-1]=Q[Q.length-1],oe}function at(Q,Ce,pe){return Q+(Ce-Q)*pe}function Ve(Q,Ce){for(var pe=new Float64Array(Ce),he=0,oe=Q.length,Ae=0;Ae<oe;Ae++){var Be=Q[Ae];pe.set(Be,he),he+=Be.length}return pe}function nt(Q,Ce){for(var pe=Q.length+Ce.length,he=new Float64Array(pe),oe=0,Ae=0;Ae<pe;)he[Ae++]=Q[oe],he[Ae++]=Ce[oe],oe++;return he}function Pe(Q,Ce,pe){for(var he=pe.length,oe=0;oe<he;oe++)Q.setUint8(Ce+oe,pe.charCodeAt(oe))}var je;O===2&&(je=nt(q,me)),O===1&&(je=q);var Ne=je.length,ot=44+Ne*2,Ge=new ArrayBuffer(ot),ie=new DataView(Ge);Pe(ie,0,"RIFF"),ie.setUint32(4,36+Ne*2,!0),Pe(ie,8,"WAVE"),Pe(ie,12,"fmt "),ie.setUint32(16,16,!0),ie.setUint16(20,1,!0),ie.setUint16(22,O,!0),ie.setUint32(24,ne,!0),ie.setUint32(28,ne*O*2,!0),ie.setUint16(32,O*2,!0),ie.setUint16(34,16,!0),Pe(ie,36,"data"),ie.setUint32(40,Ne*2,!0);for(var st=Ne,Qe=44,dt=1,$e=0;$e<st;$e++)ie.setInt16(Qe,je[$e]*(32767*dt),!0),Qe+=2;if(W)return W({buffer:Ge,view:ie});postMessage({buffer:Ge,view:ie})}if(I.noWorker){f(I,function(A){J(A.buffer,A.view)});return}var w=h(f);w.onmessage=function(A){J(A.data.buffer,A.data.view),G.revokeObjectURL(w.workerURL),w.terminate()},w.postMessage(I)}function h(I){var J=G.createObjectURL(new Blob([I.toString(),";this.onmessage =  function (eee) {"+I.name+"(eee.data);}"],{type:"application/javascript"})),f=new Worker(J);return f.workerURL=J,f}this.stop=function(I){I=I||function(){},d=!1,b({desiredSampRate:y,sampleRate:n,numberOfAudioChannels:l,internalInterleavedLength:c,leftBuffers:o,rightBuffers:l===1?[]:s,noWorker:e.noWorker},function(J,f){t.blob=new Blob([f],{type:"audio/wav"}),t.buffer=new ArrayBuffer(f.buffer.byteLength),t.view=f,t.sampleRate=y||n,t.bufferSize=B,t.length=c,u=!1,I&&I(t.blob)})},typeof k.Storage>"u"&&(k.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!k.Storage.AudioContextConstructor||k.Storage.AudioContextConstructor.state==="closed")&&(k.Storage.AudioContextConstructor=new k.Storage.AudioContext);var v=k.Storage.AudioContextConstructor,p=v.createMediaStreamSource(r),T=[0,256,512,1024,2048,4096,8192,16384],B=typeof e.bufferSize>"u"?4096:e.bufferSize;if(T.indexOf(B)===-1&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(T,null,"	"))),v.createJavaScriptNode)i=v.createJavaScriptNode(B,l,l);else if(v.createScriptProcessor)i=v.createScriptProcessor(B,l,l);else throw"WebAudio API has no support on this browser.";p.connect(i),e.bufferSize||(B=i.bufferSize);var n=typeof e.sampleRate<"u"?e.sampleRate:v.sampleRate||44100;(n<22050||n>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var g=!1;this.pause=function(){g=!0},this.resume=function(){if(m()===!1)throw"Please make sure MediaStream is active.";if(!d){e.disableLogs||console.log("Seems recording has been restarted."),this.record();return}g=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,d&&this.stop(a),a()};function M(){o=[],s=[],c=0,u=!1,d=!1,g=!1,v=null,t.leftchannel=o,t.rightchannel=s,t.numberOfAudioChannels=l,t.desiredSampRate=y,t.sampleRate=n,t.recordingLength=c,S={left:[],right:[],recordingLength:0}}function a(){i&&(i.onaudioprocess=null,i.disconnect(),i=null),p&&(p.disconnect(),p=null),M()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var u=!1;function x(I){if(!g){if(m()===!1&&(e.disableLogs||console.log("MediaStream seems stopped."),i.disconnect(),d=!1),!d){p&&(p.disconnect(),p=null);return}u||(u=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var J=I.inputBuffer.getChannelData(0),f=new Float32Array(J);if(o.push(f),l===2){var w=I.inputBuffer.getChannelData(1),A=new Float32Array(w);s.push(A)}c+=B,t.recordingLength=c,typeof e.timeSlice<"u"&&(S.recordingLength+=B,S.left.push(f),l===2&&S.right.push(A))}}i.onaudioprocess=x,v.createMediaStreamDestination?i.connect(v.createMediaStreamDestination()):i.connect(v.destination),this.leftchannel=o,this.rightchannel=s,this.numberOfAudioChannels=l,this.desiredSampRate=y,this.sampleRate=n,t.recordingLength=c;var S={left:[],right:[],recordingLength:0};function _(){!d||typeof e.ondataavailable!="function"||typeof e.timeSlice>"u"||(S.left.length?(b({desiredSampRate:y,sampleRate:n,numberOfAudioChannels:l,internalInterleavedLength:S.recordingLength,leftBuffers:S.left,rightBuffers:l===1?[]:S.right},function(I,J){var f=new Blob([J],{type:"audio/wav"});e.ondataavailable(f),setTimeout(_,e.timeSlice)}),S={left:[],right:[],recordingLength:0}):setTimeout(_,e.timeSlice))}}typeof k<"u"&&(k.StereoAudioRecorder=ke);/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function Te(r,e){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";e=e||{},e.frameInterval||(e.frameInterval=10);var t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(T){T in document.createElement("canvas")&&(t=!0)});var o=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,s=50,d=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);o&&d&&d[2]&&(s=parseInt(d[2],10)),o&&s<52&&(t=!1),e.useWhammyRecorder&&(t=!1);var c,i;if(t)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),r instanceof HTMLCanvasElement)c=r;else if(r instanceof CanvasRenderingContext2D)c=r.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var l;this.record=function(){if(l=!0,t&&!e.useWhammyRecorder){var T;"captureStream"in c?T=c.captureStream(25):"mozCaptureStream"in c?T=c.mozCaptureStream(25):"webkitCaptureStream"in c&&(T=c.webkitCaptureStream(25));try{var B=new ee;B.addTrack(R(T,"video")[0]),T=B}catch{}if(!T)throw"captureStream API are NOT available.";i=new z(T,{mimeType:e.mimeType||"video/webm"}),i.record()}else p.frames=[],v=new Date().getTime(),h();e.initCallback&&e.initCallback()},this.getWebPImages=function(T){if(r.nodeName.toLowerCase()!=="canvas"){T();return}var B=p.frames.length;p.frames.forEach(function(n,g){var M=B-g;e.disableLogs||console.log(M+"/"+B+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(M,B);var a=n.image.toDataURL("image/webp",1);p.frames[g].image=a}),e.disableLogs||console.log("Generating WebM"),T()},this.stop=function(T){l=!1;var B=this;if(t&&i){i.stop(T);return}this.getWebPImages(function(){p.compile(function(n){e.disableLogs||console.log("Recording finished!"),B.blob=n,B.blob.forEach&&(B.blob=new Blob([],{type:"video/webm"})),T&&T(B.blob),p.frames=[]})})};var y=!1;this.pause=function(){if(y=!0,i instanceof z){i.pause();return}},this.resume=function(){if(y=!1,i instanceof z){i.resume();return}l||this.record()},this.clearRecordedData=function(){l&&this.stop(m),m()};function m(){p.frames=[],l=!1,y=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function b(){var T=document.createElement("canvas"),B=T.getContext("2d");return T.width=r.width,T.height=r.height,B.drawImage(r,0,0),T}function h(){if(y)return v=new Date().getTime(),setTimeout(h,500);if(r.nodeName.toLowerCase()==="canvas"){var T=new Date().getTime()-v;v=new Date().getTime(),p.frames.push({image:b(),duration:T}),l&&setTimeout(h,e.frameInterval);return}html2canvas(r,{grabMouse:typeof e.showMousePointer>"u"||e.showMousePointer,onrendered:function(B){var n=new Date().getTime()-v;if(!n)return setTimeout(h,e.frameInterval);v=new Date().getTime(),p.frames.push({image:B.toDataURL("image/webp",1),duration:n}),l&&setTimeout(h,e.frameInterval)}})}var v=new Date().getTime(),p=new De.Video(100)}typeof k<"u"&&(k.CanvasRecorder=Te);/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function xe(r,e){e=e||{},e.frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),l.width=e.canvas.width||320,l.height=e.canvas.height||240,y=l.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(m=e.video.cloneNode(),e.initCallback&&e.initCallback()):(m=document.createElement("video"),te(r,m),m.onloadedmetadata=function(){e.initCallback&&e.initCallback()},m.width=e.video.width,m.height=e.video.height),m.muted=!0,m.play(),b=new Date().getTime(),h=new De.Video,e.disableLogs||(console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",m.width||l.width,"*",m.height||l.height)),t(e.frameInterval)};function t(v){v=typeof v<"u"?v:10;var p=new Date().getTime()-b;if(!p)return setTimeout(t,v,v);if(c)return b=new Date().getTime(),setTimeout(t,100);b=new Date().getTime(),m.paused&&m.play(),y.drawImage(m,0,0,l.width,l.height),h.frames.push({duration:p,image:l.toDataURL("image/webp")}),d||setTimeout(t,v,v)}function o(v){var p=-1,T=v.length;(function B(){if(p++,p===T){v.callback();return}setTimeout(function(){v.functionToLoop(B,p)},1)})()}function s(v,p,T,B,n){var g=document.createElement("canvas");g.width=l.width,g.height=l.height;var M=g.getContext("2d"),a=[],u=v.length,x={r:0,g:0,b:0},S=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),_=0,I=0,J=!1;o({length:u,functionToLoop:function(f,w){var A,W,O,q=function(){!J&&O-A<=O*I||(J=!0,a.push(v[w])),f()};if(J)q();else{var me=new Image;me.onload=function(){M.drawImage(me,0,0,l.width,l.height);var ne=M.getImageData(0,0,l.width,l.height);A=0,W=ne.data.length,O=ne.data.length/4;for(var Le=0;Le<W;Le+=4){var ye={r:ne.data[Le],g:ne.data[Le+1],b:ne.data[Le+2]},Fe=Math.sqrt(Math.pow(ye.r-x.r,2)+Math.pow(ye.g-x.g,2)+Math.pow(ye.b-x.b,2));Fe<=S*_&&A++}q()},me.src=v[w].image}},callback:function(){a=a.concat(v.slice(u)),a.length<=0&&a.push(v[v.length-1]),n(a)}})}var d=!1;this.stop=function(v){v=v||function(){},d=!0;var p=this;setTimeout(function(){s(h.frames,-1,null,null,function(T){h.frames=T,e.advertisement&&e.advertisement.length&&(h.frames=e.advertisement.concat(h.frames)),h.compile(function(B){p.blob=B,p.blob.forEach&&(p.blob=new Blob([],{type:"video/webm"})),v&&v(p.blob)})})},10)};var c=!1;this.pause=function(){c=!0},this.resume=function(){c=!1,d&&this.record()},this.clearRecordedData=function(){d||this.stop(i),i()};function i(){h.frames=[],d=!0,c=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var l=document.createElement("canvas"),y=l.getContext("2d"),m,b,h}typeof k<"u"&&(k.WhammyRecorder=xe);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var De=function(){function r(o){this.frames=[],this.duration=o||1,this.quality=.8}r.prototype.add=function(o,s){if("canvas"in o&&(o=o.canvas),"toDataURL"in o&&(o=o.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(o))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:o,duration:s||this.duration})};function e(o){var s=G.createObjectURL(new Blob([o.toString(),"this.onmessage =  function (eee) {"+o.name+"(eee.data);}"],{type:"application/javascript"})),d=new Worker(s);return G.revokeObjectURL(s),d}function t(o){function s(n){var g=c(n);if(!g)return[];for(var M=3e4,a=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:T(g.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:g.width,id:176},{data:g.height,id:186}]}]}]}]}],u=0,x=0;u<n.length;){var S=[],_=0;do S.push(n[u]),_+=n[u].duration,u++;while(u<n.length&&_<M);var I=0,J={id:524531317,data:d(x,I,S)};a[1].data.push(J),x+=_}return m(a)}function d(n,g,M){return[{data:n,id:231}].concat(M.map(function(a){var u=b({frame:a.data.slice(4),trackNum:1,timecode:Math.round(g)});return g+=a.duration,{data:u,id:163}}))}function c(n){if(!n[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var g=n[0].width,M=n[0].height,a=n[0].duration,u=1;u<n.length;u++)a+=n[u].duration;return{duration:a,width:g,height:M}}function i(n){for(var g=[];n>0;)g.push(n&255),n=n>>8;return new Uint8Array(g.reverse())}function l(n){return new Uint8Array(n.split("").map(function(g){return g.charCodeAt(0)}))}function y(n){var g=[],M=n.length%8?new Array(9-n.length%8).join("0"):"";n=M+n;for(var a=0;a<n.length;a+=8)g.push(parseInt(n.substr(a,8),2));return new Uint8Array(g)}function m(n){for(var g=[],M=0;M<n.length;M++){var a=n[M].data;typeof a=="object"&&(a=m(a)),typeof a=="number"&&(a=y(a.toString(2))),typeof a=="string"&&(a=l(a));var u=a.size||a.byteLength||a.length,x=Math.ceil(Math.ceil(Math.log(u)/Math.log(2))/8),S=u.toString(2),_=new Array(x*7+7+1-S.length).join("0")+S,I=new Array(x).join("0")+"1"+_;g.push(i(n[M].id)),g.push(y(I)),g.push(a)}return new Blob(g,{type:"video/webm"})}function b(n){var g=0;g|=128;var M=[n.trackNum|128,n.timecode>>8,n.timecode&255,g].map(function(a){return String.fromCharCode(a)}).join("")+n.frame;return M}function h(n){for(var g=n.RIFF[0].WEBP[0],M=g.indexOf("*"),a=0,u=[];a<4;a++)u[a]=g.charCodeAt(M+3+a);var x,S,_;return _=u[1]<<8|u[0],x=_&16383,_=u[3]<<8|u[2],S=_&16383,{width:x,height:S,data:g,riff:n}}function v(n,g){return parseInt(n.substr(g+4,4).split("").map(function(M){var a=M.charCodeAt(0).toString(2);return new Array(8-a.length+1).join("0")+a}).join(""),2)}function p(n){for(var g=0,M={};g<n.length;){var a=n.substr(g,4),u=v(n,g),x=n.substr(g+4+4,u);g+=8+u,M[a]=M[a]||[],a==="RIFF"||a==="LIST"?M[a].push(p(x)):M[a].push(x)}return M}function T(n){return[].slice.call(new Uint8Array(new Float64Array([n]).buffer),0).map(function(g){return String.fromCharCode(g)}).reverse().join("")}var B=new s(o.map(function(n){var g=h(p(atob(n.image.slice(23))));return g.duration=n.duration,g}));postMessage(B)}return r.prototype.compile=function(o){var s=e(t);s.onmessage=function(d){if(d.data.error){console.error(d.data.error);return}o(d.data)},s.postMessage(this.frames)},{Video:r}}();typeof k<"u"&&(k.Whammy=De);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var re={init:function(){var r=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var e=1,t=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),o,s=indexedDB.open(t,e);function d(i){i.createObjectStore(r.dataStoreName)}function c(){var i=o.transaction([r.dataStoreName],"readwrite");r.videoBlob&&i.objectStore(r.dataStoreName).put(r.videoBlob,"videoBlob"),r.gifBlob&&i.objectStore(r.dataStoreName).put(r.gifBlob,"gifBlob"),r.audioBlob&&i.objectStore(r.dataStoreName).put(r.audioBlob,"audioBlob");function l(y){i.objectStore(r.dataStoreName).get(y).onsuccess=function(m){r.callback&&r.callback(m.target.result,y)}}l("audioBlob"),l("videoBlob"),l("gifBlob")}s.onerror=r.onError,s.onsuccess=function(){if(o=s.result,o.onerror=r.onError,o.setVersion)if(o.version!==e){var i=o.setVersion(e);i.onsuccess=function(){d(o),c()}}else c();else c()},s.onupgradeneeded=function(i){d(i.target.result)}},Fetch:function(r){return this.callback=r,this.init(),this},Store:function(r){return this.audioBlob=r.audioBlob,this.videoBlob=r.videoBlob,this.gifBlob=r.gifBlob,this.init(),this},onError:function(r){console.error(JSON.stringify(r,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof k<"u"&&(k.DiskStorage=re);/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function Ie(r,e){if(typeof GIFEncoder>"u"){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}e=e||{};var o=r instanceof CanvasRenderingContext2D||r instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(v.record,1e3);return}if(!l){setTimeout(v.record,1e3);return}o||(e.width||(e.width=y.offsetWidth||320),e.height||(e.height=y.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),c.width=e.canvas.width||320,c.height=e.canvas.height||240,y.width=e.video.width||320,y.height=e.video.height||240),h=new GIFEncoder,h.setRepeat(0),h.setDelay(e.frameRate||200),h.setQuality(e.quality||10),h.start(),typeof e.onGifRecordingStarted=="function"&&e.onGifRecordingStarted();function p(T){if(v.clearedRecordedData!==!0){if(s)return setTimeout(function(){p(T)},100);m=U(p),typeof b===void 0&&(b=T),!(T-b<90)&&(!o&&y.paused&&y.play(),o||i.drawImage(y,0,0,c.width,c.height),e.onGifPreview&&e.onGifPreview(c.toDataURL("image/png")),h.addFrame(i),b=T)}}m=U(p),e.initCallback&&e.initCallback()},this.stop=function(p){p=p||function(){},m&&Z(m),this.blob=new Blob([new Uint8Array(h.stream().bin)],{type:"image/gif"}),p(this.blob),h.stream().bin=[]};var s=!1;this.pause=function(){s=!0},this.resume=function(){s=!1},this.clearRecordedData=function(){v.clearedRecordedData=!0,d()};function d(){h&&(h.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var c=document.createElement("canvas"),i=c.getContext("2d");o&&(r instanceof CanvasRenderingContext2D?(i=r,c=i.canvas):r instanceof HTMLCanvasElement&&(i=r.getContext("2d"),c=r));var l=!0;if(!o){var y=document.createElement("video");y.muted=!0,y.autoplay=!0,y.playsInline=!0,l=!1,y.onloadedmetadata=function(){l=!0},te(r,y),y.play()}var m=null,b,h,v=this}typeof k<"u"&&(k.GifRecorder=Ie);function Oe(r,e){var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(a){typeof k<"u"||a&&(typeof window<"u"||typeof $>"u"||($.navigator={userAgent:t,getUserMedia:function(){}},$.console||($.console={}),(typeof $.console.log>"u"||typeof $.console.error>"u")&&($.console.error=$.console.log=$.console.log||function(){console.log(arguments)}),typeof document>"u"&&(a.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var u={getContext:function(){return u},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return u},a.HTMLVideoElement=function(){}),typeof location>"u"&&(a.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(a.screen={width:0,height:0}),typeof y>"u"&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=$))})(typeof $<"u"?$:null),e=e||"multi-streams-mixer";var o=[],s=!1,d=document.createElement("canvas"),c=d.getContext("2d");d.style.opacity=0,d.style.position="absolute",d.style.zIndex=-1,d.style.top="-1000em",d.style.left="-1000em",d.className=e,(document.body||document.documentElement).appendChild(d),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var i=this,l=window.AudioContext;typeof l>"u"&&(typeof webkitAudioContext<"u"&&(l=webkitAudioContext),typeof mozAudioContext<"u"&&(l=mozAudioContext));var y=window.URL;typeof y>"u"&&typeof webkitURL<"u"&&(y=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var m=window.MediaStream;typeof m>"u"&&typeof webkitMediaStream<"u"&&(m=webkitMediaStream),typeof m<"u"&&typeof m.prototype.stop>"u"&&(m.prototype.stop=function(){this.getTracks().forEach(function(a){a.stop()})});var b={};typeof l<"u"?b.AudioContext=l:typeof webkitAudioContext<"u"&&(b.AudioContext=webkitAudioContext);function h(a,u){"srcObject"in u?u.srcObject=a:"mozSrcObject"in u?u.mozSrcObject=a:u.srcObject=a}this.startDrawingFrames=function(){v()};function v(){if(!s){var a=o.length,u=!1,x=[];if(o.forEach(function(_){_.stream||(_.stream={}),_.stream.fullcanvas?u=_:x.push(_)}),u)d.width=u.stream.width,d.height=u.stream.height;else if(x.length){d.width=a>1?x[0].width*2:x[0].width;var S=1;(a===3||a===4)&&(S=2),(a===5||a===6)&&(S=3),(a===7||a===8)&&(S=4),(a===9||a===10)&&(S=5),d.height=x[0].height*S}else d.width=i.width||360,d.height=i.height||240;u&&u instanceof HTMLVideoElement&&p(u),x.forEach(function(_,I){p(_,I)}),setTimeout(v,i.frameInterval)}}function p(a,u){if(!s){var x=0,S=0,_=a.width,I=a.height;u===1&&(x=a.width),u===2&&(S=a.height),u===3&&(x=a.width,S=a.height),u===4&&(S=a.height*2),u===5&&(x=a.width,S=a.height*2),u===6&&(S=a.height*3),u===7&&(x=a.width,S=a.height*3),typeof a.stream.left<"u"&&(x=a.stream.left),typeof a.stream.top<"u"&&(S=a.stream.top),typeof a.stream.width<"u"&&(_=a.stream.width),typeof a.stream.height<"u"&&(I=a.stream.height),c.drawImage(a,x,S,_,I),typeof a.stream.onRender=="function"&&a.stream.onRender(c,x,S,_,I,u)}}function T(){s=!1;var a=B(),u=n();return u&&u.getTracks().filter(function(x){return x.kind==="audio"}).forEach(function(x){a.addTrack(x)}),r.forEach(function(x){x.fullcanvas}),a}function B(){M();var a;"captureStream"in d?a=d.captureStream():"mozCaptureStream"in d?a=d.mozCaptureStream():i.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var u=new m;return a.getTracks().filter(function(x){return x.kind==="video"}).forEach(function(x){u.addTrack(x)}),d.stream=u,u}function n(){b.AudioContextConstructor||(b.AudioContextConstructor=new b.AudioContext),i.audioContext=b.AudioContextConstructor,i.audioSources=[],i.useGainNode===!0&&(i.gainNode=i.audioContext.createGain(),i.gainNode.connect(i.audioContext.destination),i.gainNode.gain.value=0);var a=0;if(r.forEach(function(u){if(u.getTracks().filter(function(S){return S.kind==="audio"}).length){a++;var x=i.audioContext.createMediaStreamSource(u);i.useGainNode===!0&&x.connect(i.gainNode),i.audioSources.push(x)}}),!!a)return i.audioDestination=i.audioContext.createMediaStreamDestination(),i.audioSources.forEach(function(u){u.connect(i.audioDestination)}),i.audioDestination.stream}function g(a){var u=document.createElement("video");return h(a,u),u.className=e,u.muted=!0,u.volume=0,u.width=a.width||i.width||360,u.height=a.height||i.height||240,u.play(),u}this.appendStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]),a.forEach(function(u){var x=new m;if(u.getTracks().filter(function(I){return I.kind==="video"}).length){var S=g(u);S.stream=u,o.push(S),x.addTrack(u.getTracks().filter(function(I){return I.kind==="video"})[0])}if(u.getTracks().filter(function(I){return I.kind==="audio"}).length){var _=i.audioContext.createMediaStreamSource(u);i.audioDestination=i.audioContext.createMediaStreamDestination(),_.connect(i.audioDestination),x.addTrack(i.audioDestination.stream.getTracks().filter(function(I){return I.kind==="audio"})[0])}r.push(x)})},this.releaseStreams=function(){o=[],s=!0,i.gainNode&&(i.gainNode.disconnect(),i.gainNode=null),i.audioSources.length&&(i.audioSources.forEach(function(a){a.disconnect()}),i.audioSources=[]),i.audioDestination&&(i.audioDestination.disconnect(),i.audioDestination=null),i.audioContext&&i.audioContext.close(),i.audioContext=null,c.clearRect(0,0,d.width,d.height),d.stream&&(d.stream.stop(),d.stream=null)},this.resetVideoStreams=function(a){a&&!(a instanceof Array)&&(a=[a]),M(a)};function M(a){o=[],a=a||r,a.forEach(function(u){if(u.getTracks().filter(function(S){return S.kind==="video"}).length){var x=g(u);x.stream=u,o.push(x)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=T}typeof k>"u"&&(Se.exports=Oe);/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */function Ee(r,e){r=r||[];var t=this,o,s;e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},e.frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){o=new Oe(r,e.elementClass||"multi-streams-mixer"),d().length&&(o.frameInterval=e.frameInterval||10,o.width=e.video.width||360,o.height=e.video.height||240,o.startDrawingFrames()),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(o.getMixedStream()),s=new z(o.getMixedStream(),e),s.record()};function d(){var c=[];return r.forEach(function(i){R(i,"video").forEach(function(l){c.push(l)})}),c}this.stop=function(c){s&&s.stop(function(i){t.blob=i,c(i),t.clearRecordedData()})},this.pause=function(){s&&s.pause()},this.resume=function(){s&&s.resume()},this.clearRecordedData=function(){s&&(s.clearRecordedData(),s=null),o&&(o.releaseStreams(),o=null)},this.addStreams=function(c){if(!c)throw"First parameter is required.";c instanceof Array||(c=[c]),r.concat(c),!(!s||!o)&&(o.appendStreams(c),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(o.getMixedStream()))},this.resetVideoStreams=function(c){o&&(c&&!(c instanceof Array)&&(c=[c]),o.resetVideoStreams(c))},this.getMixer=function(){return o},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof k<"u"&&(k.MultiStreamRecorder=Ee);/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */function qe(r,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof r>"u")throw'First argument "MediaStream" is required.';var t=this;t.recordRTC=new k(r,e),this.startRecording=function(){return new Promise(function(o,s){try{t.recordRTC.startRecording(),o()}catch(d){s(d)}})},this.stopRecording=function(){return new Promise(function(o,s){try{t.recordRTC.stopRecording(function(d){if(t.blob=t.recordRTC.getBlob(),!t.blob||!t.blob.size){s("Empty blob.",t.blob);return}o(d)})}catch(d){s(d)}})},this.pauseRecording=function(){return new Promise(function(o,s){try{t.recordRTC.pauseRecording(),o()}catch(d){s(d)}})},this.resumeRecording=function(){return new Promise(function(o,s){try{t.recordRTC.resumeRecording(),o()}catch(d){s(d)}})},this.getDataURL=function(o){return new Promise(function(s,d){try{t.recordRTC.getDataURL(function(c){s(c)})}catch(c){d(c)}})},this.getBlob=function(){return new Promise(function(o,s){try{o(t.recordRTC.getBlob())}catch(d){s(d)}})},this.getInternalRecorder=function(){return new Promise(function(o,s){try{o(t.recordRTC.getInternalRecorder())}catch(d){s(d)}})},this.reset=function(){return new Promise(function(o,s){try{o(t.recordRTC.reset())}catch(d){s(d)}})},this.destroy=function(){return new Promise(function(o,s){try{o(t.recordRTC.destroy())}catch(d){s(d)}})},this.getState=function(){return new Promise(function(o,s){try{o(t.recordRTC.getState())}catch(d){s(d)}})},this.blob=null,this.version="5.6.2"}typeof k<"u"&&(k.RecordRTCPromisesHandler=qe);/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */function Me(r,e){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),e=e||{},e.width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0;var t;function o(){return new ReadableStream({start:function(y){var m=document.createElement("canvas"),b=document.createElement("video"),h=!0;b.srcObject=r,b.muted=!0,b.height=e.height,b.width=e.width,b.volume=0,b.onplaying=function(){m.width=e.width,m.height=e.height;var v=m.getContext("2d"),p=1e3/e.frameRate,T=setInterval(function(){if(t&&(clearInterval(T),y.close()),h&&(h=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),v.drawImage(b,0,0),y._controlledReadableStream.state!=="closed")try{y.enqueue(v.getImageData(0,0,e.width,e.height))}catch{}},p)},b.play()}})}var s;function d(y,m){if(!e.workerPath&&!m){t=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(h){h.arrayBuffer().then(function(v){d(y,v)})});return}if(!e.workerPath&&m instanceof ArrayBuffer){var b=new Blob([m],{type:"text/javascript"});e.workerPath=G.createObjectURL(b)}e.workerPath||console.error("workerPath parameter is missing."),s=new Worker(e.workerPath),s.postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),s.addEventListener("message",function(h){h.data==="READY"?(s.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),o().pipeTo(new WritableStream({write:function(v){if(t){console.error("Got image, but recorder is finished!");return}s.postMessage(v.data.buffer,[v.data.buffer])}}))):h.data&&(c||l.push(h.data))})}this.record=function(){l=[],c=!1,this.blob=null,d(r),typeof e.initCallback=="function"&&e.initCallback()};var c;this.pause=function(){c=!0},this.resume=function(){c=!1};function i(y){if(!s){y&&y();return}s.addEventListener("message",function(m){m.data===null&&(s.terminate(),s=null,y&&y())}),s.postMessage(null)}var l=[];this.stop=function(y){t=!0;var m=this;i(function(){m.blob=new Blob(l,{type:"video/webm"}),y(m.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){l=[],c=!1,this.blob=null},this.blob=null}typeof k<"u"&&(k.WebAssemblyRecorder=Me)}(Ye)),Ye.exports}var Wt=zt();const qt=pt(Wt),Vt={key:0,class:"alert alert-danger flex h-16 items-center justify-between px-6"},Gt={class:""},$t={key:1,class:"flex h-16 items-center justify-between rounded-md bg-gray-50 px-4 shadow-sm dark:bg-dark-800"},Ht={class:"mr-3 flex flex-1 items-center justify-end"},Kt={key:0,class:"flex items-center gap-2"},Yt={class:"flex items-center gap-1"},Jt={class:"text-sm font-medium text-red-600 dark:text-red-400"},Qt={class:"text-sm font-medium text-gray-600 dark:text-gray-300"},Xt={class:"rounded-full bg-slate-200 dark:bg-dark-600"},Zt=["src"],er={class:"mr-2 flex items-center gap-3"},tr=["disabled"],rr={__name:"VoiceRecorder",props:{store:{type:Object,required:!0}},setup(Se){const k=Nt(),L=j({blob:null,url:null,file:null,isRecording:!1,duration:0}),ue=j(!0),H=j(null),X=j(null),U=we(()=>{const D=Math.floor(L.value.duration/60),C=L.value.duration%60;return`${D.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`}),ve=async()=>{try{const D=await navigator.mediaDevices.getUserMedia({audio:!0});H.value=new qt(D,{type:"audio"}),H.value.startRecording(),L.value.isRecording=!0,L.value.duration=0,X.value=setInterval(()=>{L.value.duration++},1e3)}catch(D){console.error("Error accessing microphone:",D),ue.value=!1,L.value.isRecording=!1}},Z=()=>{H.value&&H.value.stopRecording(()=>{L.value.blob=H.value.getBlob(),L.value.url=URL.createObjectURL(L.value.blob),X.value&&clearInterval(X.value);try{const D=H.value.stream;D&&D.getTracks&&D.getTracks().forEach(C=>C.stop())}catch(D){console.warn("Could not stop media tracks:",D)}finally{L.value.isRecording=!1,H.value.destroy(),H.value=null}})},le=()=>{L.value.url&&URL.revokeObjectURL(L.value.url),L.value.url=null,L.value.blob=null,L.value.file=null,L.value.isRecording=!1,L.value.duration=0},G=()=>{Z(),le(),k.inputMessage.type="text"},Y=()=>{k.inputMessage.type="voice",k.inputMessage.file=L.value.blob,k.submitMessage()},se=()=>{window.location.reload()};return ht(()=>{X.value&&clearInterval(X.value),H.value&&(H.value.destroy(),H.value=null),L.value.url&&URL.revokeObjectURL(L.value.url)}),(D,C)=>{const N=rt("Icon");return ue.value?(E(),V("div",$t,[F("button",{type:"button",onClick:G,class:"flex h-8 w-8 items-center justify-center rounded-full transition-colors hover:bg-gray-200 dark:hover:bg-dark-700"},[K(N,{icon:"bx:x",class:"text-gray-600 dark:text-gray-300"})]),F("div",Ht,[L.value.isRecording?(E(),V("div",Kt,[F("div",Yt,[C[0]||(C[0]=F("div",{class:"h-3 w-3 animate-pulse rounded-full bg-red-500"},null,-1)),F("span",Jt,Re(U.value),1)]),F("div",Qt,Re(D.trans("Recording"))+"... ",1)])):ae("",!0),F("div",Xt,[L.value.url&&!L.value.isRecording?(E(),V("audio",{key:0,src:L.value.url,controls:"",class:"h-10 w-64 opacity-60 dark:opacity-50"},null,8,Zt)):ae("",!0)])]),F("div",er,[L.value.url?(E(),V("button",{key:0,type:"button",onClick:le,class:"flex h-8 w-8 items-center justify-center rounded-full transition-colors hover:bg-gray-200 dark:hover:bg-dark-700"},[K(N,{icon:"bx:trash",class:"text-red-500 dark:text-red-400"})])):ae("",!0),!L.value.url&&!L.value.isRecording?(E(),V("button",{key:1,type:"button",onClick:ve,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 transition-colors hover:bg-gray-300 dark:bg-dark-700 dark:hover:bg-dark-600"},[K(N,{icon:"bx:microphone",class:"text-gray-700 dark:text-gray-200"})])):!L.value.url&&L.value.isRecording?(E(),V("button",{key:2,type:"button",onClick:Z,class:"flex h-8 w-8 items-center justify-center rounded-full bg-red-100 transition-colors hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50"},[K(N,{icon:"bx:stop",class:"text-xl text-red-600 dark:text-red-400"})])):ae("",!0),L.value.url&&!L.value.isRecording?(E(),V("button",{key:3,onClick:Y,disabled:P(k).loading.sendingMessage,class:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500 transition-colors hover:bg-green-600"},[P(k).loading.sendingMessage?(E(),We(jt,{key:0})):(E(),We(N,{key:1,icon:"bx:send",class:"text-white"}))],8,tr)):ae("",!0)])])):(E(),V("div",Vt,[F("p",Gt,Re(D.trans("This device does not support voice recording or does not have microphone access.")),1),F("button",{type:"button",class:"btn btn-secondary",onClick:se},Re(D.trans("Reload")),1)]))}}},ir={class:"relative ml-2 flex h-[calc(100vh-11rem)] w-full flex-col overflow-hidden rounded-md bg-white shadow transition-all dark:bg-dark-800"},ar={class:"styled-scrollbar whatsapp-chat-body relative h-[82%] overflow-auto px-4 pb-8"},nr={key:0,class:"space-y-3",id:"scrollContainerRef"},or={class:"my-2 text-center"},sr={key:0,class:"flex gap-x-3 group-[.pr]:flex-row-reverse"},dr={key:0,class:"avatar avatar-circle avatar-sm shrink-0"},ur=["src"],lr={class:"flex max-w-sm flex-col items-start group-[.pr]:items-end"},cr={key:0,class:"rounded-t-lg bg-white bg-opacity-50 p-2 text-sm italic text-gray-500"},fr={class:"flex items-center"},mr={class:"mb-2"},pr=["title"],hr=["title"],vr={key:0,class:"bx bx-circle"},gr={key:1,class:"bx bx-check"},br={key:2,class:"bx bx-check-double"},yr={key:3,class:"bx bx-check-double text-green-600"},wr={key:1,class:"h-200 flex items-center justify-center"},Rr={class:"relative bottom-0 left-0 z-10 rounded-b-primary border-t bg-white dark:border-dark-700 dark:bg-dark-800"},kr=["onKeydown","disabled"],xr={class:"flex items-center gap-x-4 px-4"},Cr={class:"relative"},Sr={key:0,class:"absolute bottom-full right-0"},Tr={class:"mb-2 space-y-2 rounded-md bg-dark-900 p-3"},Vr={__name:"MessageContainer",setup(Se){const k=Mt(),L=Lt(),ue=it(),{loading:H,assetPopup:X,inputMessage:U,activeConversation:ve,messageInputFieldRef:Z,quickReplySuggestionItems:le}=vt(L);gt(()=>{G(),setTimeout(()=>{var D;(D=Z.value)==null||D.focus()},500)});const G=()=>{axios.get(route("user.conversations.api",{data:"ai_templates"})).then(D=>{L.$patch({aiTemplates:D.data.data})}).catch(D=>console.error(D))};j();const Y=D=>{k.openModal({load:D,multiple:!0,caption:["image","video"].includes(D)?"":void 0,button:{text:"Send"},onOpen:()=>{X.value=!1,U.value.type=D},onSelect:C=>{},onSubmit:(C,N)=>{let ee=C.map(ce=>ce.path);if(U.value.file=ee[0]??!1,U.value.caption=N.caption,!U.value.file)return Je.warning("Attachment not found, please try again");L.submitMessage()}})},se=()=>{if(U.value.type="text",!U.value.message)return Je.warning("Please enter a message");L.submitMessage()};return(D,C)=>{var ee,ce,Ue,de;const N=rt("Icon");return E(),V("div",ir,[K(At),F("div",ar,[(ce=(ee=P(ve))==null?void 0:ee.messages)!=null&&ce.length?(E(),V("ul",nr,[F("li",or,[K(Tt,{afterIntersection:P(L).loadMoreMessages,loader:P(H).messages},null,8,["afterIntersection","loader"])]),(E(!0),V(bt,null,yt(((Ue=P(ve))==null?void 0:Ue.messages)??[],(R,te)=>{var ge,be,fe,z,ke,Te,xe,De;return E(),V("li",{class:Ct(["group",{pr:(ge=R==null?void 0:R.key)==null?void 0:ge.fromMe}]),key:te},[(be=R==null?void 0:R.message)!=null&&be.reactionMessage?ae("",!0):(E(),V("div",sr,[(fe=R==null?void 0:R.key)!=null&&fe.fromMe?ae("",!0):(E(),V("div",dr,[F("img",{src:P(L).getConversationProfilePic(P(ve)),class:"avatar-img",alt:"profile-img"},null,8,ur)])),F("div",lr,[(ke=(z=R.meta)==null?void 0:z.context)!=null&&ke.id?(E(),V("p",cr,Re((xe=(Te=R.meta)==null?void 0:Te.context)==null?void 0:xe.title),1)):ae("",!0),F("div",fr,[K(_t,{message:R},null,8,["message"])]),F("div",mr,[F("span",{class:"text-xs font-normal text-slate-400",title:P(et).unix(R.messageTimestamp).local().format("D MMM, YYYY h:mm A")},Re(P(et).unix(R.messageTimestamp).local().format("D MMM, h:mm A")),9,pr),(De=R==null?void 0:R.key)!=null&&De.fromMe?(E(),V("span",{key:0,class:"font-bolder ml-1 text-slate-300",title:R.status==1?"Pending":R.status==2?"Sent":R.status==3?"Delivered":R.status==4?"Seen":""},[R.status==1?(E(),V("i",vr)):R.status==2?(E(),V("i",gr)):R.status==3?(E(),V("i",br)):R.status==4?(E(),V("i",yr)):ae("",!0)],8,hr)):ae("",!0)])])]))],2)}),128))])):(E(),V("div",wr,C[16]||(C[16]=[F("p",{class:"text-center italic text-slate-600"},"No messages",-1)])))]),F("div",Rr,[P(L).isReplying?(E(),We(Ft,{key:0})):ae("",!0),K(Bt),P(U).type==="voice"?(E(),We(rr,{key:1,store:P(L)},null,8,["store"])):ae("",!0),Ze(K(It,null,null,512),[[wt,P(le).length>0]]),P(U).type!="voice"?(E(),V("form",{key:2,onSubmit:Ke(se,["prevent"]),class:"flex h-[4.2rem] items-center rounded-primary shadow"},[Ze(F("textarea",{ref_key:"messageInputFieldRef",ref:Z,"onUpdate:modelValue":C[0]||(C[0]=R=>P(U).message=R),onKeyup:[C[1]||(C[1]=ze((...R)=>D.onArrowDown&&D.onArrowDown(...R),["down"])),C[2]||(C[2]=ze((...R)=>D.onArrowUp&&D.onArrowUp(...R),["up"]))],onKeydown:[C[3]||(C[3]=ze(Ke((...R)=>D.selectQuickReply&&D.selectQuickReply(...R),["prevent"]),["tab"])),ze(Ke(se,["exact","prevent"]),["enter"])],disabled:P(H).sendingMessage,class:"max-h-16 min-h-16 w-full border-transparent bg-transparent px-4 text-sm text-slate-700 placeholder:text-slate-500 focus:border-transparent focus:ring-0 dark:text-slate-300 dark:placeholder:text-slate-400",placeholder:"Type message... enter to send, shift+enter to next line"},null,40,kr),[[Rt,P(U).message]]),F("div",xr,[F("button",{type:"button",onClick:C[4]||(C[4]=R=>P(ue).open("aiModal")),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[K(N,{icon:"fluent:chat-sparkle-16-regular"})]),F("button",{type:"button",onClick:C[5]||(C[5]=(...R)=>P(L).quickReplyModalOpen&&P(L).quickReplyModalOpen(...R)),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[K(N,{icon:"bxs:layer"})]),F("button",{type:"button",onClick:C[6]||(C[6]=R=>P(ue).open("TemplateMessageModal")),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[K(N,{icon:"bxs:grid"})]),(de=P(L).features)!=null&&de.voice_message?(E(),V("button",{key:0,type:"button",onClick:C[7]||(C[7]=R=>P(U).type="voice"),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[K(N,{icon:"bxs:microphone"})])):ae("",!0),F("div",Cr,[F("button",{id:"btn-upload-media",onClick:C[8]||(C[8]=R=>X.value=!P(X)),type:"button",class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[K(N,{icon:"bx:link-alt"})]),P(X)?(E(),V("div",{key:0,class:"fixed inset-0 bg-transparent",onClick:C[9]||(C[9]=R=>X.value=!1)})):ae("",!0),K(xt,{name:"fade"},{default:kt(()=>[P(X)?(E(),V("div",Sr,[F("button",{type:"button",class:"absolute -right-2 -top-3 rounded-full border border-red-500 bg-white p-1 text-end text-black hover:bg-gray-100 dark:bg-dark-900 dark:text-slate-300 dark:hover:bg-dark-700",onClick:C[10]||(C[10]=R=>X.value=!1)},[K(N,{icon:"bx:x",class:"size-3 text-red-500"})]),F("div",Tr,[F("button",{onClick:C[11]||(C[11]=()=>Y("document")),type:"button",class:"btn btn-dark btn-xs w-full"},[K(N,{icon:"bx:file"}),F("span",null,Re(D.trans("Documents")),1)]),F("button",{onClick:C[12]||(C[12]=R=>Y("image")),type:"button",class:"btn btn-dark btn-xs w-full"},[K(N,{icon:"bx:image"}),F("span",null,Re(D.trans("Image")),1)]),F("button",{onClick:C[13]||(C[13]=()=>Y("video")),type:"button",class:"btn btn-dark btn-xs w-full"},[K(N,{icon:"bx:video"}),F("span",null,Re(D.trans("Video")),1)]),F("button",{onClick:C[14]||(C[14]=()=>Y("audio")),type:"button",class:"btn btn-dark btn-xs w-full"},[K(N,{icon:"bx:microphone"}),F("span",null,Re(D.trans("Audio")),1)]),F("button",{onClick:C[15]||(C[15]=()=>P(ue).open("locationMessageModal")),type:"button",class:"btn btn-dark btn-xs w-full"},[K(N,{icon:"bx:map"}),F("span",null,Re(D.trans("Location")),1)])])])):ae("",!0)]),_:1})]),K(St,{icon:"bx:send","btn-text":"",disabled:P(H).sendingMessage},null,8,["disabled"])])],32)):ae("",!0)])])}}};export{Vr as default};
